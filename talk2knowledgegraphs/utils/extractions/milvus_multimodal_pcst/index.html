
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../multimodal_pcst/">
      
      
        <link rel="next" href="../../../agents/t2kg_agent/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.18">
    
    
      
        <title>PCST (Milvus Multimodal) - AIAgents4Pharma</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../../../VPE.png">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="black">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="AIAgents4Pharma" class="md-header__button md-logo" aria-label="AIAgents4Pharma" data-md-component="logo">
      
  <img src="../../../../assets/VPE.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            AIAgents4Pharma
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              PCST (Milvus Multimodal)
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="black"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6m0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4M7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="white" data-md-color-accent="black"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/VirtualPatientEngine/AIAgents4Pharma" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    VPE/AIAgents4Pharma
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../talk2aiagents4pharma/intro/" class="md-tabs__link">
          
  
  
    
  
  Talk2AIAgents4Pharma

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../talk2biomodels/intro/" class="md-tabs__link">
          
  
  
    
  
  Talk2Biomodels

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../talk2cells/intro/" class="md-tabs__link">
          
  
  
    
  
  Talk2Cells

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../intro/" class="md-tabs__link">
          
  
  
    
  
  Talk2KnowledgeGraphs

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../talk2scholars/intro/" class="md-tabs__link">
          
  
  
    
  
  Talk2Scholars

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../developer/" class="md-tabs__link">
          
  
  
    
  
  Documentation

        </a>
      </li>
    
  

    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="AIAgents4Pharma" class="md-nav__button md-logo" aria-label="AIAgents4Pharma" data-md-component="logo">
      
  <img src="../../../../assets/VPE.png" alt="logo">

    </a>
    AIAgents4Pharma
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/VirtualPatientEngine/AIAgents4Pharma" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    VPE/AIAgents4Pharma
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Talk2AIAgents4Pharma
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Talk2AIAgents4Pharma
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2aiagents4pharma/intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Agents
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            Agents
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2aiagents4pharma/agents/main_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    T2AA4P agent
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_3" >
        
          
          <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    States
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_3">
            <span class="md-nav__icon md-icon"></span>
            States
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2aiagents4pharma/states/state_talk2aiagents4pharma/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    T2AA4P state
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Talk2Biomodels
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Talk2Biomodels
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2biomodels/intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2biomodels/faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Case Studies
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Case Studies
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2biomodels/cases/Case_1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Precision medicine
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2biomodels/cases/Case_2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Epidemiology
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2biomodels/cases/Case_3/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Emergent system properties
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_4" >
        
          
          <label class="md-nav__link" for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notebooks/talk2biomodels/basico_tutorials/example_models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Model Examples
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Benchmark
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            Benchmark
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notebooks/talk2biomodels/benchmark/benchmark/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Description
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Agents
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            Agents
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2biomodels/agents/t2b_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    T2B agent
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_7" >
        
          
          <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    States
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_7">
            <span class="md-nav__icon md-icon"></span>
            States
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2biomodels/states/state_talk2biomodels/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    T2B state
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_8" >
        
          
          <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Models
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            Models
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2biomodels/models/sys_bio_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    System Bio Model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2biomodels/models/basico_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Basico Model
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_9" >
        
          
          <label class="md-nav__link" for="__nav_3_9" id="__nav_3_9_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tools
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_9">
            <span class="md-nav__icon md-icon"></span>
            Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2biomodels/tools/search_models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Search models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2biomodels/tools/get_modelinfo/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Model information
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2biomodels/tools/get_annotation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Model annotation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2biomodels/tools/simulate_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Simulate model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2biomodels/tools/ask_question/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Ask questions
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2biomodels/tools/custom_plotter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Custom plots
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2biomodels/tools/load_biomodel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Load biomodel
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2biomodels/tools/save_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Save model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2biomodels/tools/parameter_scan/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Parameter scan
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2biomodels/tools/steady_state/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Steady state
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Talk2Cells
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Talk2Cells
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2cells/intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notebooks/talk2cells/tutorial_c2s/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cell annotations with cell2sentence
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notebooks/talk2cells/tutorial_cell_annotation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cell Annotation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notebooks/talk2cells/tutorial_cell_discovery/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cell Discovery
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notebooks/talk2cells/tutorial_UMAP_visualization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UMAP Visualization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notebooks/talk2cells/tutorial_cell_type_proportion/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Cell Type Proportion
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3" >
        
          
          <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Agents
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_3">
            <span class="md-nav__icon md-icon"></span>
            Agents
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2cells/agents/intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Agent Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2cells/agents/scp_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SCP Agent
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_4" >
        
          
          <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    States
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_4">
            <span class="md-nav__icon md-icon"></span>
            States
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2cells/states/state_talk2cells/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Talk2Cells
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5" >
        
          
          <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tools
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_5">
            <span class="md-nav__icon md-icon"></span>
            Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2cells/tools/search_studies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Search studies
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2cells/tools/display_studies/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Display studies
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
        
        
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Talk2KnowledgeGraphs
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Talk2KnowledgeGraphs
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2" >
        
          
          <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Deployment
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_2">
            <span class="md-nav__icon md-icon"></span>
            Deployment
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../deployment/custom_data/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Custom Data
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../deployment/deployment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Deployment
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../faq/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_4" >
        
          
          <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_4">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notebooks/talk2knowledgegraphs/tutorial_primekg_loader/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PrimeKG Loader
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notebooks/talk2knowledgegraphs/tutorial_starkqa_primekg_loader/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    StarkQA-PrimeKG Loader
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notebooks/talk2knowledgegraphs/tutorial_biobridge_primekg_loader/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    BioBridge-PrimeKG Loader
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notebooks/talk2knowledgegraphs/tutorial_primekg_subgraph/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PrimeKG Subgraph Construction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notebooks/talk2knowledgegraphs/tutorial_biobridge_multimodal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multimodal BioBridge-PrimeKG Graph Construction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notebooks/talk2knowledgegraphs/tutorial_biobridge_ibd_multimodal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multimodal BioBridge-PrimeKG (IBD) Graph Construction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notebooks/talk2knowledgegraphs/tutorial_starkqa_primekg_textual_embeddings_all_minilm/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Textual Embeddings for StarkQA-PrimeKG using all-MiniLM-L6-v1
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notebooks/talk2knowledgegraphs/tutorial_starkqa_primekg_textual_embeddings_nomic_embed_text/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Textual Embeddings for StarkQA-PrimeKG using nomic-embed-text
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notebooks/talk2knowledgegraphs/tutorial_starkqa_primekg_textual_enrichments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notebooks/talk2knowledgegraphs/tutorial_primekg_smiles_enrich_embed/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Drug Enrichments/Embeddings (SMILES/molmim)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notebooks/talk2knowledgegraphs/tutorial_primekg_enrichment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PrimeKG Enrichment and Embedding
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notebooks/talk2knowledgegraphs/tutorial_biobridge_primekg_protein_embeddings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Protein Embeddings for BioBridge-PrimeKG
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notebooks/talk2knowledgegraphs/tutorial_multimodal_embeddings_alignment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multimodal Embeddings Alignment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notebooks/talk2knowledgegraphs/tutorial_starkqa_primekg_evaluation_vss/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    StarkQA-PrimeKG Evaluation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notebooks/talk2knowledgegraphs/tutorial_talk2kg_agentic_tools/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Talk2KGs Agentic Tools
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notebooks/talk2knowledgegraphs/tutorial_pyg2dataframe/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PyG2DataFrame
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notebooks/talk2knowledgegraphs/tutorial_uniprot_mapping/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    UniProt ID Mapping
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_5" >
        
          
          <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Milvus Vector DB Setup
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_5">
            <span class="md-nav__icon md-icon"></span>
            Milvus Vector DB Setup
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notebooks/talk2knowledgegraphs/tutorial_biobridge_ibd_multimodal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multimodal BioBridge-PrimeKG (IBD) Graph Construction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notebooks/talk2knowledgegraphs/tutorial_primekg_milvus_ibd_primekg_dump/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    BioBridge-PrimeKG (IBD) Multimodal Data Dump
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notebooks/talk2knowledgegraphs/tutorial_biobridge_multimodal/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multimodal BioBridge-PrimeKG Graph Construction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notebooks/talk2knowledgegraphs/tutorial_primekg_milvus_data_dump/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    BioBridge-PrimeKG Multimodal Data Dump
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_6" >
        
          
          <label class="md-nav__link" for="__nav_5_6" id="__nav_5_6_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Datasets
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_6">
            <span class="md-nav__icon md-icon"></span>
            Datasets
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../datasets/dataset/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dataset
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../datasets/primekg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PrimeKG
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../datasets/starkqa_primekg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    StarkQA-PrimeKG
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../datasets/biobridge_primekg/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    BioBridge-PrimeKG
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_7" checked>
        
          
          <label class="md-nav__link" for="__nav_5_7" id="__nav_5_7_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Utils
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_7">
            <span class="md-nav__icon md-icon"></span>
            Utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_7_1" >
        
          
          <label class="md-nav__link" for="__nav_5_7_1" id="__nav_5_7_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Database
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_7_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_7_1">
            <span class="md-nav__icon md-icon"></span>
            Database
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../database/milvus_connection_manager/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MilvusConnectionManager
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_7_2" >
        
          
          <label class="md-nav__link" for="__nav_5_7_2" id="__nav_5_7_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Embeddings
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_7_2">
            <span class="md-nav__icon md-icon"></span>
            Embeddings
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../embeddings/embeddings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Embeddings
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../embeddings/sentence_transformer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    EmbeddingWithSentenceTransformer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../embeddings/huggingface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    EmbeddingWithHuggingFace
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../embeddings/ollama/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    EmbeddingWithOllama
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../embeddings/nim_molmim/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    EmbeddingWithMOLMIM
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_7_3" >
        
          
          <label class="md-nav__link" for="__nav_5_7_3" id="__nav_5_7_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Enrichments
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_7_3">
            <span class="md-nav__icon md-icon"></span>
            Enrichments
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../enrichments/enrichments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Enrichments
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../enrichments/ollama/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    EnrichmentWithOllama
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../enrichments/pubchem_strings/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    EnrichmentWithPubChem
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../enrichments/uniprot_proteins/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    EnrichmentWithUniProt
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../enrichments/reactome_pathways/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    EnrichmentWithReactome
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../enrichments/ols_terms/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    EnrichmentWithOLS
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_7_4" checked>
        
          
          <label class="md-nav__link" for="__nav_5_7_4" id="__nav_5_7_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Extractions
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_5_7_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5_7_4">
            <span class="md-nav__icon md-icon"></span>
            Extractions
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pcst/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PCST
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multimodal_pcst/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PCST (Multimodal)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    PCST (Milvus Multimodal)
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    PCST (Milvus Multimodal)
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst" class="md-nav__link">
    <span class="md-ellipsis">
      milvus_multimodal_pcst
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.DynamicLibraryLoader" class="md-nav__link">
    <span class="md-ellipsis">
      DynamicLibraryLoader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DynamicLibraryLoader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.DynamicLibraryLoader._import_libraries" class="md-nav__link">
    <span class="md-ellipsis">
      _import_libraries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.DynamicLibraryLoader._setup_cpu_mode" class="md-nav__link">
    <span class="md-ellipsis">
      _setup_cpu_mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.DynamicLibraryLoader.normalize_matrix" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_matrix
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.DynamicLibraryLoader.to_list" class="md-nav__link">
    <span class="md-ellipsis">
      to_list
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning" class="md-nav__link">
    <span class="md-ellipsis">
      MultimodalPCSTPruning
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MultimodalPCSTPruning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning._compute_edge_prizes" class="md-nav__link">
    <span class="md-ellipsis">
      _compute_edge_prizes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning._compute_edge_prizes_async" class="md-nav__link">
    <span class="md-ellipsis">
      _compute_edge_prizes_async
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning._compute_node_prizes" class="md-nav__link">
    <span class="md-ellipsis">
      _compute_node_prizes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning._compute_node_prizes_async" class="md-nav__link">
    <span class="md-ellipsis">
      _compute_node_prizes_async
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning._process_edge_prizes" class="md-nav__link">
    <span class="md-ellipsis">
      _process_edge_prizes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning.compute_prizes" class="md-nav__link">
    <span class="md-ellipsis">
      compute_prizes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning.compute_prizes_async" class="md-nav__link">
    <span class="md-ellipsis">
      compute_prizes_async
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning.compute_subgraph_costs" class="md-nav__link">
    <span class="md-ellipsis">
      compute_subgraph_costs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning.extract_subgraph" class="md-nav__link">
    <span class="md-ellipsis">
      extract_subgraph
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning.get_subgraph_nodes_edges" class="md-nav__link">
    <span class="md-ellipsis">
      get_subgraph_nodes_edges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning.load_edge_index" class="md-nav__link">
    <span class="md-ellipsis">
      load_edge_index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning.load_edge_index_async" class="md-nav__link">
    <span class="md-ellipsis">
      load_edge_index_async
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning.prepare_collections" class="md-nav__link">
    <span class="md-ellipsis">
      prepare_collections
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.SystemDetector" class="md-nav__link">
    <span class="md-ellipsis">
      SystemDetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SystemDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.SystemDetector._detect_nvidia_gpu" class="md-nav__link">
    <span class="md-ellipsis">
      _detect_nvidia_gpu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.SystemDetector.get_system_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_system_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.SystemDetector.is_gpu_compatible" class="md-nav__link">
    <span class="md-ellipsis">
      is_gpu_compatible
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_8" >
        
          
          <label class="md-nav__link" for="__nav_5_8" id="__nav_5_8_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Agents
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_8">
            <span class="md-nav__icon md-icon"></span>
            Agents
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../agents/t2kg_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Talk2KG Agent
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_9" >
        
          
          <label class="md-nav__link" for="__nav_5_9" id="__nav_5_9_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    States
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_9">
            <span class="md-nav__icon md-icon"></span>
            States
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../states/state_talk2knowledgegraphs/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Talk2KG State
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
          
          
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_10" >
        
          
          <label class="md-nav__link" for="__nav_5_10" id="__nav_5_10_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Tools
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5_10">
            <span class="md-nav__icon md-icon"></span>
            Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/subgraph_extraction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Subgraph Extraction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/multimodal_subgraph_extraction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Subgraph Extraction (Multimodal)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/milvus_multimodal_subgraph_extraction/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Subgraph Extraction (Milvus Multimodal)
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/subgraph_summarization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Subgraph Summarization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/graphrag_reasoning/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GraphRAG Reasoning
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tools/load_arguments/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Load Arguments
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Talk2Scholars
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Talk2Scholars
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Introduction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../notebooks/talk2scholars/tutorial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tutorials
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_3" >
        
          
          <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Agents
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_3">
            <span class="md-nav__icon md-icon"></span>
            Agents
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/agents/main_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Main Agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/agents/s2_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    S2 Agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/agents/paper_download_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Paper Download Agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/agents/zotero_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Zotero Agent
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/agents/pdf_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    PDF Agent
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_4" >
        
          
          <label class="md-nav__link" for="__nav_6_4" id="__nav_6_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    States
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_4">
            <span class="md-nav__icon md-icon"></span>
            States
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/states/state_talk2scholars/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Talk2Scholars state
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_5" >
        
          
          <label class="md-nav__link" for="__nav_6_5" id="__nav_6_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Tools
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_5">
            <span class="md-nav__icon md-icon"></span>
            Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/tools/search/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Search Papers
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/tools/single_paper_rec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Single Paper Recommendation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/tools/multi_paper_rec/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multi Paper Recommendation
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/tools/display_dataframe/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Display Dataframe
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/tools/query_dataframe/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Query Dataframe
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/tools/retrieve_semantic_scholar_paper_id/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Retrieve Semantic Scholar ID
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/tools/paper_downloader/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Paper Downloader
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/tools/question_and_answer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Question and answer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/tools/zotero_read/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Zotero Read
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/tools/zotero_write/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Zotero Write
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/tools/zotero_review/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Zotero Review
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_6" >
        
          
          <label class="md-nav__link" for="__nav_6_6" id="__nav_6_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Utils
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_6_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_6">
            <span class="md-nav__icon md-icon"></span>
            Utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_6_1" >
        
          
          <label class="md-nav__link" for="__nav_6_6_1" id="__nav_6_6_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    S2 Agent
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_6_1">
            <span class="md-nav__icon md-icon"></span>
            S2 Agent
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/utils/search_helper/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Search Helper
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/utils/single_helper/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Single Paper Recommendation Helper
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/utils/multi_helper/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Multi Paper Recommendation Helper
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_6_2" >
        
          
          <label class="md-nav__link" for="__nav_6_6_2" id="__nav_6_6_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    PDF Agent
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_6_2">
            <span class="md-nav__icon md-icon"></span>
            PDF Agent
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/utils/vector_store/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vector Store
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/utils/singleton_manager/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Singleton Manager
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/utils/gpu_detection/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GPU Detection
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/utils/collection_manager/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Collection Manager
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/utils/get_vectorstore/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Get Vector Store
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/utils/document_processor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Document Processor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/utils/paper_loader/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Paper Loader
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/utils/batch_processor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Batch Processor
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/utils/rag_pipeline/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    RAG Pipeline
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/utils/vector_normalization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Vector Normalization
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/utils/retrieve_chunks/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Retrieve Chunks
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/utils/nvidia_nim_reranker/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Nvidia NIM Reranker
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/utils/generate_answer/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Generate Answer
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/utils/answer_formatter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Answer Formatter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/utils/tool_helper/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tool Helper
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_6_3" >
        
          
          <label class="md-nav__link" for="__nav_6_6_3" id="__nav_6_6_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Paper Download Agent
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_6_3">
            <span class="md-nav__icon md-icon"></span>
            Paper Download Agent
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/utils/base_paper_downloader/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Base Paper Downloader
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/utils/arxiv_downloader/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Arxiv Downloader
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/utils/biorxiv_downloader/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Biorxiv Downloader
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/utils/medrxiv_downloader/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Medrxiv Downloader
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/utils/pubmed_downloader/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Pubmed Downloader
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6_6_4" >
        
          
          <label class="md-nav__link" for="__nav_6_6_4" id="__nav_6_6_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Zotero Agent
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_6_6_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6_6_4">
            <span class="md-nav__icon md-icon"></span>
            Zotero Agent
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/utils/write_helper/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Zotero Write Helper
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/utils/read_helper/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Zotero Read Helper
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/utils/review_helper/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Zotero Review Helper
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/utils/zotero_path/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Zotero Path
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../talk2scholars/utils/zotero_pdf_downloader/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Zotero PDF Downloader
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Documentation
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Documentation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_1" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../developer/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    Developer Guides
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_1" id="__nav_7_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_1">
            <span class="md-nav__icon md-icon"></span>
            Developer Guides
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../developer/TESTING_LINTING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Testing & Linting
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../developer/WORKFLOWS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    GitHub Workflows
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../developer/STREAMLIT_SECURITY/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Streamlit Security
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../developer/SONARCLOUD_SETUP/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    SonarCloud Setup
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../developer/AZURE_DEPLOYMENT/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Azure Deployment
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_2" >
        
          
          <label class="md-nav__link" for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Operations
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            Operations
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ops/Documentation_intro/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Operations Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ops/CodeOps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Code Operations
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ops/DevOps/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Dev Operations
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7_3" >
        
          
          <label class="md-nav__link" for="__nav_7_3" id="__nav_7_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Project Guidelines
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7_3">
            <span class="md-nav__icon md-icon"></span>
            Project Guidelines
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../CONTRIBUTING/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing Guide
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst" class="md-nav__link">
    <span class="md-ellipsis">
      milvus_multimodal_pcst
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.DynamicLibraryLoader" class="md-nav__link">
    <span class="md-ellipsis">
      DynamicLibraryLoader
    </span>
  </a>
  
    <nav class="md-nav" aria-label="DynamicLibraryLoader">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.DynamicLibraryLoader._import_libraries" class="md-nav__link">
    <span class="md-ellipsis">
      _import_libraries
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.DynamicLibraryLoader._setup_cpu_mode" class="md-nav__link">
    <span class="md-ellipsis">
      _setup_cpu_mode
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.DynamicLibraryLoader.normalize_matrix" class="md-nav__link">
    <span class="md-ellipsis">
      normalize_matrix
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.DynamicLibraryLoader.to_list" class="md-nav__link">
    <span class="md-ellipsis">
      to_list
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning" class="md-nav__link">
    <span class="md-ellipsis">
      MultimodalPCSTPruning
    </span>
  </a>
  
    <nav class="md-nav" aria-label="MultimodalPCSTPruning">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning._compute_edge_prizes" class="md-nav__link">
    <span class="md-ellipsis">
      _compute_edge_prizes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning._compute_edge_prizes_async" class="md-nav__link">
    <span class="md-ellipsis">
      _compute_edge_prizes_async
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning._compute_node_prizes" class="md-nav__link">
    <span class="md-ellipsis">
      _compute_node_prizes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning._compute_node_prizes_async" class="md-nav__link">
    <span class="md-ellipsis">
      _compute_node_prizes_async
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning._process_edge_prizes" class="md-nav__link">
    <span class="md-ellipsis">
      _process_edge_prizes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning.compute_prizes" class="md-nav__link">
    <span class="md-ellipsis">
      compute_prizes
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning.compute_prizes_async" class="md-nav__link">
    <span class="md-ellipsis">
      compute_prizes_async
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning.compute_subgraph_costs" class="md-nav__link">
    <span class="md-ellipsis">
      compute_subgraph_costs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning.extract_subgraph" class="md-nav__link">
    <span class="md-ellipsis">
      extract_subgraph
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning.get_subgraph_nodes_edges" class="md-nav__link">
    <span class="md-ellipsis">
      get_subgraph_nodes_edges
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning.load_edge_index" class="md-nav__link">
    <span class="md-ellipsis">
      load_edge_index
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning.load_edge_index_async" class="md-nav__link">
    <span class="md-ellipsis">
      load_edge_index_async
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning.prepare_collections" class="md-nav__link">
    <span class="md-ellipsis">
      prepare_collections
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.SystemDetector" class="md-nav__link">
    <span class="md-ellipsis">
      SystemDetector
    </span>
  </a>
  
    <nav class="md-nav" aria-label="SystemDetector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.SystemDetector._detect_nvidia_gpu" class="md-nav__link">
    <span class="md-ellipsis">
      _detect_nvidia_gpu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.SystemDetector.get_system_info" class="md-nav__link">
    <span class="md-ellipsis">
      get_system_info
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.SystemDetector.is_gpu_compatible" class="md-nav__link">
    <span class="md-ellipsis">
      is_gpu_compatible
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>PCST (Milvus Multimodal)</h1>

<div class="doc doc-object doc-module">



<a id="aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst"></a>
    <div class="doc doc-contents first">

        <p>Exctraction of multimodal subgraph using Prize-Collecting Steiner Tree (PCST) algorithm.</p>










  <div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.DynamicLibraryLoader" class="doc doc-heading">
            <code>DynamicLibraryLoader</code>


</h2>


    <div class="doc doc-contents ">


        <p>Dynamically load libraries based on system capabilities.</p>








              <details class="quote">
                <summary>Source code in <code>aiagents4pharma/talk2knowledgegraphs/utils/extractions/milvus_multimodal_pcst.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">DynamicLibraryLoader</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dynamically load libraries based on system capabilities.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">detector</span><span class="p">:</span> <span class="n">SystemDetector</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">detector</span> <span class="o">=</span> <span class="n">detector</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_gpu</span> <span class="o">=</span> <span class="n">detector</span><span class="o">.</span><span class="n">use_gpu</span>

        <span class="c1"># Initialize attributes that will be set later</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">py</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pd</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">np</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cudf</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cp</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Import libraries based on system capabilities</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_import_libraries</span><span class="p">()</span>

        <span class="c1"># Dynamic settings based on hardware</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normalize_vectors</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_gpu</span>  <span class="c1"># Only normalize for GPU</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metric_type</span> <span class="o">=</span> <span class="s2">&quot;IP&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_gpu</span> <span class="k">else</span> <span class="s2">&quot;COSINE&quot;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Library Configuration:&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  Using GPU acceleration: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_gpu</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  Vector normalization: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize_vectors</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  Metric type: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric_type</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_import_libraries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Dynamically import libraries based on system capabilities.&quot;&quot;&quot;</span>
        <span class="c1"># Set base libraries</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pd</span> <span class="o">=</span> <span class="n">pd</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">np</span> <span class="o">=</span> <span class="n">np</span>

        <span class="c1"># Conditionally import GPU libraries</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">use_gpu</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">CUDF_AVAILABLE</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cudf</span> <span class="o">=</span> <span class="n">cudf</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cp</span> <span class="o">=</span> <span class="n">cp</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">py</span> <span class="o">=</span> <span class="n">cp</span>  <span class="c1"># Use cupy for array operations</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">cudf</span>  <span class="c1"># Use cudf for dataframes</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully imported GPU libraries (cudf, cupy)&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;cudf or cupy not found. Falling back to CPU mode.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">use_gpu</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">use_gpu</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_setup_cpu_mode</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setup_cpu_mode</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_setup_cpu_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup CPU mode with numpy and pandas.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">py</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">np</span>  <span class="c1"># Use numpy for array operations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pd</span>  <span class="c1"># Use pandas for dataframes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">normalize_vectors</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">metric_type</span> <span class="o">=</span> <span class="s2">&quot;COSINE&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using CPU mode with numpy and pandas&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">normalize_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Normalize matrix using appropriate library.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize_vectors</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">matrix</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_gpu</span><span class="p">:</span>
            <span class="c1"># Use cupy for GPU</span>
            <span class="n">matrix_cp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
            <span class="n">norms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">matrix_cp</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">matrix_cp</span> <span class="o">/</span> <span class="n">norms</span>
        <span class="c1"># CPU mode doesn&#39;t normalize for COSINE similarity</span>
        <span class="k">return</span> <span class="n">matrix</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">to_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Convert data to list format.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;tolist&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;to_arrow&quot;</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">to_arrow</span><span class="p">()</span><span class="o">.</span><span class="n">to_pylist</span><span class="p">()</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.DynamicLibraryLoader._import_libraries" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_import_libraries</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Dynamically import libraries based on system capabilities.</p>


            <details class="quote">
              <summary>Source code in <code>aiagents4pharma/talk2knowledgegraphs/utils/extractions/milvus_multimodal_pcst.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_import_libraries</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Dynamically import libraries based on system capabilities.&quot;&quot;&quot;</span>
    <span class="c1"># Set base libraries</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pd</span> <span class="o">=</span> <span class="n">pd</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">np</span> <span class="o">=</span> <span class="n">np</span>

    <span class="c1"># Conditionally import GPU libraries</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">use_gpu</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">CUDF_AVAILABLE</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cudf</span> <span class="o">=</span> <span class="n">cudf</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cp</span> <span class="o">=</span> <span class="n">cp</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">py</span> <span class="o">=</span> <span class="n">cp</span>  <span class="c1"># Use cupy for array operations</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="n">cudf</span>  <span class="c1"># Use cudf for dataframes</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully imported GPU libraries (cudf, cupy)&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;cudf or cupy not found. Falling back to CPU mode.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">detector</span><span class="o">.</span><span class="n">use_gpu</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">use_gpu</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_setup_cpu_mode</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_setup_cpu_mode</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.DynamicLibraryLoader._setup_cpu_mode" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_setup_cpu_mode</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Setup CPU mode with numpy and pandas.</p>


            <details class="quote">
              <summary>Source code in <code>aiagents4pharma/talk2knowledgegraphs/utils/extractions/milvus_multimodal_pcst.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_setup_cpu_mode</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Setup CPU mode with numpy and pandas.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">py</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">np</span>  <span class="c1"># Use numpy for array operations</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pd</span>  <span class="c1"># Use pandas for dataframes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">normalize_vectors</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">metric_type</span> <span class="o">=</span> <span class="s2">&quot;COSINE&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Using CPU mode with numpy and pandas&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.DynamicLibraryLoader.normalize_matrix" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">normalize_matrix</span><span class="p">(</span><span class="n">matrix</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Normalize matrix using appropriate library.</p>


            <details class="quote">
              <summary>Source code in <code>aiagents4pharma/talk2knowledgegraphs/utils/extractions/milvus_multimodal_pcst.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">normalize_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">matrix</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normalize matrix using appropriate library.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">normalize_vectors</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">matrix</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_gpu</span><span class="p">:</span>
        <span class="c1"># Use cupy for GPU</span>
        <span class="n">matrix_cp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">matrix</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">norms</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">matrix_cp</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">matrix_cp</span> <span class="o">/</span> <span class="n">norms</span>
    <span class="c1"># CPU mode doesn&#39;t normalize for COSINE similarity</span>
    <span class="k">return</span> <span class="n">matrix</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.DynamicLibraryLoader.to_list" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Convert data to list format.</p>


            <details class="quote">
              <summary>Source code in <code>aiagents4pharma/talk2knowledgegraphs/utils/extractions/milvus_multimodal_pcst.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert data to list format.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;tolist&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="s2">&quot;to_arrow&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">data</span><span class="o">.</span><span class="n">to_arrow</span><span class="p">()</span><span class="o">.</span><span class="n">to_pylist</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning" class="doc doc-heading">
            <code>MultimodalPCSTPruning</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><span title="typing.NamedTuple">NamedTuple</span></code></p>


        <p>Prize-Collecting Steiner Tree (PCST) pruning algorithm implementation inspired by G-Retriever
(He et al., 'G-Retriever: Retrieval-Augmented Generation for Textual Graph Understanding and
Question Answering', NeurIPS 2024) paper.
https://arxiv.org/abs/2402.07630
https://github.com/XiaoxinHe/G-Retriever/blob/main/src/dataset/utils/retrieval.py</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>topk</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of top nodes to consider.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>topk_e</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of top edges to consider.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cost_e</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The cost of the edges.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>c_const</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The constant value for the cost of the edges computation.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>root</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The root node of the subgraph, -1 for unrooted.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_clusters</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of clusters.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pruning</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The pruning strategy to use.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>verbosity_level</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The verbosity level.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_description</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use description embeddings.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>metric_type</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The similarity metric type (dynamic based on hardware).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>loader</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dynamic library loader instance.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="quote">
                <summary>Source code in <code>aiagents4pharma/talk2knowledgegraphs/utils/extractions/milvus_multimodal_pcst.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">MultimodalPCSTPruning</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prize-Collecting Steiner Tree (PCST) pruning algorithm implementation inspired by G-Retriever</span>
<span class="sd">    (He et al., &#39;G-Retriever: Retrieval-Augmented Generation for Textual Graph Understanding and</span>
<span class="sd">    Question Answering&#39;, NeurIPS 2024) paper.</span>
<span class="sd">    https://arxiv.org/abs/2402.07630</span>
<span class="sd">    https://github.com/XiaoxinHe/G-Retriever/blob/main/src/dataset/utils/retrieval.py</span>

<span class="sd">    Args:</span>
<span class="sd">        topk: The number of top nodes to consider.</span>
<span class="sd">        topk_e: The number of top edges to consider.</span>
<span class="sd">        cost_e: The cost of the edges.</span>
<span class="sd">        c_const: The constant value for the cost of the edges computation.</span>
<span class="sd">        root: The root node of the subgraph, -1 for unrooted.</span>
<span class="sd">        num_clusters: The number of clusters.</span>
<span class="sd">        pruning: The pruning strategy to use.</span>
<span class="sd">        verbosity_level: The verbosity level.</span>
<span class="sd">        use_description: Whether to use description embeddings.</span>
<span class="sd">        metric_type: The similarity metric type (dynamic based on hardware).</span>
<span class="sd">        loader: The dynamic library loader instance.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">topk</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">topk_e</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">cost_e</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">c_const</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.01</span>
    <span class="n">root</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">num_clusters</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">pruning</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;gw&quot;</span>
    <span class="n">verbosity_level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">use_description</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">metric_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Will be set dynamically</span>
    <span class="n">loader</span><span class="p">:</span> <span class="n">DynamicLibraryLoader</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">prepare_collections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">modality</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prepare the collections for nodes, node-type specific nodes, and edges in Milvus.</span>

<span class="sd">        Args:</span>
<span class="sd">            cfg: The configuration dictionary containing the Milvus setup.</span>
<span class="sd">            modality: The modality to use for the subgraph extraction.</span>

<span class="sd">        Returns:</span>
<span class="sd">            A dictionary containing the collections of nodes, node-type specific nodes, and edges.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialize the collections dictionary</span>
        <span class="n">colls</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Load the collection for nodes</span>
        <span class="n">colls</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Collection</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cfg</span><span class="o">.</span><span class="n">milvus_db</span><span class="o">.</span><span class="n">database_name</span><span class="si">}</span><span class="s2">_nodes&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">modality</span> <span class="o">!=</span> <span class="s2">&quot;prompt&quot;</span><span class="p">:</span>
            <span class="c1"># Load the collection for the specific node type</span>
            <span class="n">colls</span><span class="p">[</span><span class="s2">&quot;nodes_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Collection</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cfg</span><span class="o">.</span><span class="n">milvus_db</span><span class="o">.</span><span class="n">database_name</span><span class="si">}</span><span class="s2">_nodes_</span><span class="si">{</span><span class="n">modality</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="c1"># Load the collection for edges</span>
        <span class="n">colls</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Collection</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cfg</span><span class="o">.</span><span class="n">milvus_db</span><span class="o">.</span><span class="n">database_name</span><span class="si">}</span><span class="s2">_edges&quot;</span><span class="p">)</span>

        <span class="c1"># Load the collections</span>
        <span class="k">for</span> <span class="n">coll</span> <span class="ow">in</span> <span class="n">colls</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="n">coll</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">colls</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">load_edge_index_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">_connection_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load edge index using hybrid async/sync approach to avoid event loop issues.</span>

<span class="sd">        This method queries the edges collection to get head_index and tail_index,</span>
<span class="sd">        eliminating the need for pickle caching and reducing memory usage.</span>

<span class="sd">        Args:</span>
<span class="sd">            cfg: The configuration dictionary containing the Milvus setup.</span>
<span class="sd">            _connection_manager: Unused parameter for interface compatibility.</span>

<span class="sd">        Returns:</span>
<span class="sd">            numpy.ndarray: Edge index array with shape [2, num_edges]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Loading edge index from Milvus collection (hybrid)&quot;</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">load_edges_sync</span><span class="p">():</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Load edges synchronously to avoid event loop issues.&quot;&quot;&quot;</span>

            <span class="n">collection_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cfg</span><span class="o">.</span><span class="n">milvus_db</span><span class="o">.</span><span class="n">database_name</span><span class="si">}</span><span class="s2">_edges&quot;</span>
            <span class="n">edges_collection</span> <span class="o">=</span> <span class="n">Collection</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">)</span>
            <span class="n">edges_collection</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

            <span class="c1"># Query all edges in batches</span>
            <span class="n">batch_size</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">milvus_db</span><span class="p">,</span> <span class="s2">&quot;query_batch_size&quot;</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
            <span class="n">total_entities</span> <span class="o">=</span> <span class="n">edges_collection</span><span class="o">.</span><span class="n">num_entities</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Total edges to process: </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">total_entities</span><span class="p">)</span>

            <span class="n">head_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">tail_list</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">start</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">total_entities</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
                <span class="n">end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">total_entities</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Processing edge batch: </span><span class="si">%d</span><span class="s2"> to </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

                <span class="n">batch</span> <span class="o">=</span> <span class="n">edges_collection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                    <span class="n">expr</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;triplet_index &gt;= </span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2"> and triplet_index &lt; </span><span class="si">{</span><span class="n">end</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                    <span class="n">output_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;head_index&quot;</span><span class="p">,</span> <span class="s2">&quot;tail_index&quot;</span><span class="p">],</span>
                <span class="p">)</span>

                <span class="n">head_list</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;head_index&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">])</span>
                <span class="n">tail_list</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;tail_index&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">])</span>

            <span class="c1"># Convert to numpy array format expected by PCST</span>
            <span class="n">edge_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">head_list</span><span class="p">,</span> <span class="n">tail_list</span><span class="p">])</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
                <span class="s2">&quot;Edge index loaded (hybrid): shape </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="nb">str</span><span class="p">(</span><span class="n">edge_index</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="n">edge_index</span>

        <span class="c1"># Run in thread to avoid event loop conflicts</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">to_thread</span><span class="p">(</span><span class="n">load_edges_sync</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_edge_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load edge index synchronously from Milvus collection.</span>

<span class="sd">        This method queries the edges collection to get head_index and tail_index.</span>

<span class="sd">        Args:</span>
<span class="sd">            cfg: The configuration dictionary containing the Milvus setup.</span>

<span class="sd">        Returns:</span>
<span class="sd">            numpy.ndarray: Edge index array with shape [2, num_edges]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Loading edge index from Milvus collection (sync)&quot;</span><span class="p">)</span>

        <span class="n">collection_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cfg</span><span class="o">.</span><span class="n">milvus_db</span><span class="o">.</span><span class="n">database_name</span><span class="si">}</span><span class="s2">_edges&quot;</span>
        <span class="n">edges_collection</span> <span class="o">=</span> <span class="n">Collection</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">)</span>
        <span class="n">edges_collection</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

        <span class="c1"># Query all edges in batches</span>
        <span class="n">batch_size</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">milvus_db</span><span class="p">,</span> <span class="s2">&quot;query_batch_size&quot;</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
        <span class="n">total_entities</span> <span class="o">=</span> <span class="n">edges_collection</span><span class="o">.</span><span class="n">num_entities</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Total edges to process: </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">total_entities</span><span class="p">)</span>

        <span class="n">head_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tail_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">start</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">total_entities</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
            <span class="n">end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">total_entities</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Processing edge batch: </span><span class="si">%d</span><span class="s2"> to </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

            <span class="n">batch</span> <span class="o">=</span> <span class="n">edges_collection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                <span class="n">expr</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;triplet_index &gt;= </span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2"> and triplet_index &lt; </span><span class="si">{</span><span class="n">end</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">output_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;head_index&quot;</span><span class="p">,</span> <span class="s2">&quot;tail_index&quot;</span><span class="p">],</span>
            <span class="p">)</span>

            <span class="n">head_list</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;head_index&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">])</span>
            <span class="n">tail_list</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;tail_index&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">])</span>

        <span class="c1"># Convert to numpy array format expected by PCST</span>
        <span class="n">edge_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">head_list</span><span class="p">,</span> <span class="n">tail_list</span><span class="p">])</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
            <span class="s2">&quot;Edge index loaded (sync): shape </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">edge_index</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">edge_index</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_node_prizes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_emb</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">colls</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the node prizes based on the similarity between the query and nodes.</span>

<span class="sd">        Args:</span>
<span class="sd">            query_emb: The query embedding. This can be an embedding of</span>
<span class="sd">                a prompt, sequence, or any other feature to be used for the subgraph extraction.</span>
<span class="sd">            colls: The collections of nodes, node-type specific nodes, and edges in Milvus.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The prizes of the nodes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialize several variables</span>
        <span class="n">topk</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topk</span><span class="p">,</span> <span class="n">colls</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">num_entities</span><span class="p">)</span>
        <span class="n">n_prizes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">colls</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">num_entities</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="c1"># Get the actual metric type to use</span>
        <span class="n">actual_metric_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric_type</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">metric_type</span>

        <span class="c1"># Calculate similarity for text features and update the score</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_description</span><span class="p">:</span>
            <span class="c1"># Search the collection with the text embedding</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">colls</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">query_emb</span><span class="p">],</span>
                <span class="n">anns_field</span><span class="o">=</span><span class="s2">&quot;desc_emb&quot;</span><span class="p">,</span>
                <span class="n">param</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;metric_type&quot;</span><span class="p">:</span> <span class="n">actual_metric_type</span><span class="p">},</span>
                <span class="n">limit</span><span class="o">=</span><span class="n">topk</span><span class="p">,</span>
                <span class="n">output_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;node_id&quot;</span><span class="p">],</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Search the collection with the query embedding</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">colls</span><span class="p">[</span><span class="s2">&quot;nodes_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
                <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">query_emb</span><span class="p">],</span>
                <span class="n">anns_field</span><span class="o">=</span><span class="s2">&quot;feat_emb&quot;</span><span class="p">,</span>
                <span class="n">param</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;metric_type&quot;</span><span class="p">:</span> <span class="n">actual_metric_type</span><span class="p">},</span>
                <span class="n">limit</span><span class="o">=</span><span class="n">topk</span><span class="p">,</span>
                <span class="n">output_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;node_id&quot;</span><span class="p">],</span>
            <span class="p">)</span>

        <span class="c1"># Update the prizes based on the search results</span>
        <span class="n">n_prizes</span><span class="p">[[</span><span class="n">r</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">topk</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">float32</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">n_prizes</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_compute_node_prizes_async</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">query_emb</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
        <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">connection_manager</span><span class="p">,</span>
        <span class="n">use_description</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the node prizes asynchronously using connection manager.</span>

<span class="sd">        Args:</span>
<span class="sd">            query_emb: The query embedding</span>
<span class="sd">            collection_name: Name of the collection to search</span>
<span class="sd">            connection_manager: The MilvusConnectionManager instance</span>
<span class="sd">            use_description: Whether to use description embeddings</span>

<span class="sd">        Returns:</span>
<span class="sd">            The prizes of the nodes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get collection stats for initialization</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="k">await</span> <span class="n">connection_manager</span><span class="o">.</span><span class="n">async_get_collection_stats</span><span class="p">(</span><span class="n">collection_name</span><span class="p">)</span>
        <span class="n">num_entities</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;num_entities&quot;</span><span class="p">]</span>

        <span class="c1"># Initialize prizes array</span>
        <span class="n">topk</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topk</span><span class="p">,</span> <span class="n">num_entities</span><span class="p">)</span>
        <span class="n">n_prizes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_entities</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="c1"># Get the actual metric type to use</span>
        <span class="n">actual_metric_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric_type</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">metric_type</span>

        <span class="c1"># Determine search field based on use_description</span>
        <span class="n">anns_field</span> <span class="o">=</span> <span class="s2">&quot;desc_emb&quot;</span> <span class="k">if</span> <span class="n">use_description</span> <span class="k">else</span> <span class="s2">&quot;feat_emb&quot;</span>

        <span class="c1"># Perform async search</span>
        <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">connection_manager</span><span class="o">.</span><span class="n">async_search</span><span class="p">(</span>
            <span class="n">collection_name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">query_emb</span><span class="p">],</span>
            <span class="n">anns_field</span><span class="o">=</span><span class="n">anns_field</span><span class="p">,</span>
            <span class="n">param</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;metric_type&quot;</span><span class="p">:</span> <span class="n">actual_metric_type</span><span class="p">},</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">topk</span><span class="p">,</span>
            <span class="n">output_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;node_id&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="c1"># Update the prizes based on the search results</span>
        <span class="k">if</span> <span class="n">results</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">result_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">hit</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">hit</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">n_prizes</span><span class="p">[</span><span class="n">result_ids</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">topk</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">n_prizes</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_compute_edge_prizes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text_emb</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">colls</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the edge prizes based on the similarity between the query and edges.</span>

<span class="sd">        Args:</span>
<span class="sd">            text_emb: The textual description embedding.</span>
<span class="sd">            colls: The collections of nodes, node-type specific nodes, and edges in Milvus.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The prizes of the edges.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialize several variables</span>
        <span class="n">topk_e</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topk_e</span><span class="p">,</span> <span class="n">colls</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">num_entities</span><span class="p">)</span>
        <span class="n">e_prizes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">colls</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">num_entities</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="c1"># Get the actual metric type to use</span>
        <span class="n">actual_metric_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric_type</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">metric_type</span>

        <span class="c1"># Search the collection with the query embedding</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">colls</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">text_emb</span><span class="p">],</span>
            <span class="n">anns_field</span><span class="o">=</span><span class="s2">&quot;feat_emb&quot;</span><span class="p">,</span>
            <span class="n">param</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;metric_type&quot;</span><span class="p">:</span> <span class="n">actual_metric_type</span><span class="p">},</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">topk_e</span><span class="p">,</span>  <span class="c1"># Only retrieve the top-k edges</span>
            <span class="n">output_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;head_id&quot;</span><span class="p">,</span> <span class="s2">&quot;tail_id&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="c1"># Update the prizes based on the search results</span>
        <span class="n">e_prizes</span><span class="p">[[</span><span class="n">r</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">score</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="c1"># Further process the edge_prizes</span>
        <span class="n">unique_prizes</span><span class="p">,</span> <span class="n">inverse_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">e_prizes</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">topk_e_values</span> <span class="o">=</span> <span class="n">unique_prizes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="n">unique_prizes</span><span class="p">)[:</span><span class="n">topk_e</span><span class="p">]]</span>
        <span class="n">last_topk_e_value</span> <span class="o">=</span> <span class="n">topk_e</span>
        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">topk_e</span><span class="p">):</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">inverse_indices</span> <span class="o">==</span> <span class="p">(</span><span class="n">unique_prizes</span> <span class="o">==</span> <span class="n">topk_e_values</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">min</span><span class="p">((</span><span class="n">topk_e</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="n">indices</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">last_topk_e_value</span><span class="p">)</span>
            <span class="n">e_prizes</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">last_topk_e_value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_const</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">e_prizes</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_compute_edge_prizes_async</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">text_emb</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">connection_manager</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the edge prizes asynchronously using connection manager.</span>

<span class="sd">        Args:</span>
<span class="sd">            text_emb: The textual description embedding</span>
<span class="sd">            collection_name: Name of the edges collection</span>
<span class="sd">            connection_manager: The MilvusConnectionManager instance</span>

<span class="sd">        Returns:</span>
<span class="sd">            The prizes of the edges</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get collection stats for initialization</span>
        <span class="n">stats</span> <span class="o">=</span> <span class="k">await</span> <span class="n">connection_manager</span><span class="o">.</span><span class="n">async_get_collection_stats</span><span class="p">(</span><span class="n">collection_name</span><span class="p">)</span>
        <span class="n">num_entities</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;num_entities&quot;</span><span class="p">]</span>

        <span class="c1"># Initialize prizes array</span>
        <span class="n">topk_e</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topk_e</span><span class="p">,</span> <span class="n">num_entities</span><span class="p">)</span>
        <span class="n">e_prizes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_entities</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="c1"># Get the actual metric type to use</span>
        <span class="n">actual_metric_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric_type</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">metric_type</span>

        <span class="c1"># Perform async search</span>
        <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">connection_manager</span><span class="o">.</span><span class="n">async_search</span><span class="p">(</span>
            <span class="n">collection_name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">,</span>
            <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">text_emb</span><span class="p">],</span>
            <span class="n">anns_field</span><span class="o">=</span><span class="s2">&quot;feat_emb&quot;</span><span class="p">,</span>
            <span class="n">param</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;metric_type&quot;</span><span class="p">:</span> <span class="n">actual_metric_type</span><span class="p">},</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">topk_e</span><span class="p">,</span>
            <span class="n">output_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;head_id&quot;</span><span class="p">,</span> <span class="s2">&quot;tail_id&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="c1"># Update the prizes based on the search results</span>
        <span class="k">if</span> <span class="n">results</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">result_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">hit</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">hit</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
            <span class="n">result_scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">hit</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">hit</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>  <span class="c1"># Use distance/score</span>
            <span class="n">e_prizes</span><span class="p">[</span><span class="n">result_ids</span><span class="p">]</span> <span class="o">=</span> <span class="n">result_scores</span>

        <span class="c1"># Process edge prizes using helper method</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_edge_prizes</span><span class="p">(</span><span class="n">e_prizes</span><span class="p">,</span> <span class="n">topk_e</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_edge_prizes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e_prizes</span><span class="p">,</span> <span class="n">topk_e</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Helper method to process edge prizes and reduce complexity.&quot;&quot;&quot;</span>
        <span class="n">unique_prizes</span><span class="p">,</span> <span class="n">inverse_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">e_prizes</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">sorted_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="n">unique_prizes</span><span class="p">)[:</span><span class="n">topk_e</span><span class="p">]</span>
        <span class="n">topk_e_values</span> <span class="o">=</span> <span class="n">unique_prizes</span><span class="p">[</span><span class="n">sorted_indices</span><span class="p">]</span>
        <span class="n">last_topk_e_value</span> <span class="o">=</span> <span class="n">topk_e</span>

        <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">topk_e</span><span class="p">):</span>
            <span class="n">indices</span> <span class="o">=</span> <span class="n">inverse_indices</span> <span class="o">==</span> <span class="p">(</span><span class="n">unique_prizes</span> <span class="o">==</span> <span class="n">topk_e_values</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">min</span><span class="p">((</span><span class="n">topk_e</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="n">indices</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">last_topk_e_value</span><span class="p">)</span>
            <span class="n">e_prizes</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">last_topk_e_value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_const</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">e_prizes</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_prizes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text_emb</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">query_emb</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">colls</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the node prizes based on the cosine similarity between the query and nodes,</span>
<span class="sd">        as well as the edge prizes based on the cosine similarity between the query and edges.</span>
<span class="sd">        Note that the node and edge embeddings shall use the same embedding model and dimensions</span>
<span class="sd">        with the query.</span>

<span class="sd">        Args:</span>
<span class="sd">            text_emb: The textual description embedding.</span>
<span class="sd">            query_emb: The query embedding. This can be an embedding of</span>
<span class="sd">                a prompt, sequence, or any other feature to be used for the subgraph extraction.</span>
<span class="sd">            colls: The collections of nodes, node-type specific nodes, and edges in Milvus.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The prizes of the nodes and edges.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Compute prizes for nodes</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;_compute_node_prizes&quot;</span><span class="p">)</span>
        <span class="n">n_prizes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_node_prizes</span><span class="p">(</span><span class="n">query_emb</span><span class="p">,</span> <span class="n">colls</span><span class="p">)</span>

        <span class="c1"># Compute prizes for edges</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;_compute_edge_prizes&quot;</span><span class="p">)</span>
        <span class="n">e_prizes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_edge_prizes</span><span class="p">(</span><span class="n">text_emb</span><span class="p">,</span> <span class="n">colls</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;nodes&quot;</span><span class="p">:</span> <span class="n">n_prizes</span><span class="p">,</span> <span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="n">e_prizes</span><span class="p">}</span>

    <span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">compute_prizes_async</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">text_emb</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">query_emb</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">cfg</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">modality</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute node and edge prizes asynchronously in parallel using sync fallback.</span>

<span class="sd">        Args:</span>
<span class="sd">            text_emb: The textual description embedding</span>
<span class="sd">            query_emb: The query embedding</span>
<span class="sd">            cfg: The configuration dictionary containing the Milvus setup</span>
<span class="sd">            modality: The modality to use for the subgraph extraction</span>

<span class="sd">        Returns:</span>
<span class="sd">            The prizes of the nodes and edges</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Computing prizes in parallel (hybrid async/sync)&quot;</span><span class="p">)</span>

        <span class="c1"># Use existing sync method wrapped in asyncio.to_thread</span>
        <span class="n">colls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_collections</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">modality</span><span class="p">)</span>
        <span class="k">return</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">to_thread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">compute_prizes</span><span class="p">,</span> <span class="n">text_emb</span><span class="p">,</span> <span class="n">query_emb</span><span class="p">,</span> <span class="n">colls</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">compute_subgraph_costs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge_index</span><span class="p">,</span> <span class="n">num_nodes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">prizes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute the costs in constructing the subgraph proposed by G-Retriever paper.</span>

<span class="sd">        Args:</span>
<span class="sd">            edge_index: The edge index of the graph, consisting of source and destination nodes.</span>
<span class="sd">            num_nodes: The number of nodes in the graph.</span>
<span class="sd">            prizes: The prizes of the nodes and the edges.</span>

<span class="sd">        Returns:</span>
<span class="sd">            edges: The edges of the subgraph, consisting of edges and number of edges without</span>
<span class="sd">                virtual edges.</span>
<span class="sd">            prizes: The prizes of the subgraph.</span>
<span class="sd">            costs: The costs of the subgraph.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Initialize several variables</span>
        <span class="n">real_</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">virt_</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Update edge cost threshold</span>
        <span class="n">updated_cost_e</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cost_e</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">prizes</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_const</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="c1"># Masks for real and virtual edges</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Creating masks for real and virtual edges&quot;</span><span class="p">)</span>
        <span class="n">real_</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prizes</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">updated_cost_e</span>
        <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">~</span><span class="n">real_</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span>

        <span class="c1"># Real edge indices</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Computing real edges&quot;</span><span class="p">)</span>
        <span class="n">real_</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">real_</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">real_</span><span class="p">[</span><span class="s2">&quot;src&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_index</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">real_</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">]]</span>
        <span class="n">real_</span><span class="p">[</span><span class="s2">&quot;dst&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_index</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">real_</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">]]</span>
        <span class="n">real_</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">real_</span><span class="p">[</span><span class="s2">&quot;src&quot;</span><span class="p">],</span> <span class="n">real_</span><span class="p">[</span><span class="s2">&quot;dst&quot;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">real_</span><span class="p">[</span><span class="s2">&quot;costs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">updated_cost_e</span> <span class="o">-</span> <span class="n">prizes</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">][</span><span class="n">real_</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">]]</span>

        <span class="c1"># Edge index mapping: local real edge idx -&gt; original global index</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Creating mapping for real edges&quot;</span><span class="p">)</span>
        <span class="n">mapping_edges</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">real_</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">])),</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="n">real_</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">]),</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Virtual edge handling</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Computing virtual edges&quot;</span><span class="p">)</span>
        <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;src&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_index</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">]]</span>
        <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;dst&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_index</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">]]</span>
        <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;prizes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prizes</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">][</span><span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">]]</span> <span class="o">-</span> <span class="n">updated_cost_e</span>

        <span class="c1"># Generate virtual node IDs</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Generating virtual node IDs&quot;</span><span class="p">)</span>
        <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;num&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;node_ids&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">num_nodes</span> <span class="o">+</span> <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;num&quot;</span><span class="p">])</span>

        <span class="c1"># Virtual edges: (src → virtual), (virtual → dst)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Creating virtual edges&quot;</span><span class="p">)</span>
        <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;edges_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;src&quot;</span><span class="p">],</span> <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;node_ids&quot;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;edges_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;node_ids&quot;</span><span class="p">],</span> <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;dst&quot;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;edges_1&quot;</span><span class="p">],</span> <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;edges_2&quot;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;costs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
            <span class="p">(</span><span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">real_</span><span class="p">[</span><span class="s2">&quot;costs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span>
        <span class="p">)</span>

        <span class="c1"># Combine real and virtual edges/costs</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Combining real and virtual edges/costs&quot;</span><span class="p">)</span>
        <span class="n">all_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">real_</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">],</span> <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">all_costs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">real_</span><span class="p">[</span><span class="s2">&quot;costs&quot;</span><span class="p">],</span> <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;costs&quot;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Final prizes</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Getting final prizes&quot;</span><span class="p">)</span>
        <span class="n">final_prizes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">prizes</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">],</span> <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;prizes&quot;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Mapping virtual node ID -&gt; edge index in original graph</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Creating mapping for virtual nodes&quot;</span><span class="p">)</span>
        <span class="n">mapping_nodes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
            <span class="nb">zip</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;node_ids&quot;</span><span class="p">]),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">]),</span>
                <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

        <span class="c1"># Build return values</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Building return values&quot;</span><span class="p">)</span>
        <span class="n">edges_dict</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="n">all_edges</span><span class="p">,</span>
            <span class="s2">&quot;num_prior_edges&quot;</span><span class="p">:</span> <span class="n">real_</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
        <span class="p">}</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="n">mapping_edges</span><span class="p">,</span>
            <span class="s2">&quot;nodes&quot;</span><span class="p">:</span> <span class="n">mapping_nodes</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">edges_dict</span><span class="p">,</span> <span class="n">final_prizes</span><span class="p">,</span> <span class="n">all_costs</span><span class="p">,</span> <span class="n">mapping</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_subgraph_nodes_edges</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">num_nodes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">edges_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">mapping</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the selected nodes and edges of the subgraph based on the vertices and edges computed</span>
<span class="sd">        by the PCST algorithm.</span>

<span class="sd">        Args:</span>
<span class="sd">            num_nodes: The number of nodes in the graph.</span>
<span class="sd">            vertices: The vertices selected by the PCST algorithm.</span>
<span class="sd">            edges_dict: A dictionary containing the edges and the number of prior edges.</span>
<span class="sd">            mapping: A dictionary containing the mapping of nodes and edges.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The selected nodes and edges of the extracted subgraph.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Get edges information</span>
        <span class="n">edges</span> <span class="o">=</span> <span class="n">edges_dict</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">]</span>
        <span class="n">num_prior_edges</span> <span class="o">=</span> <span class="n">edges_dict</span><span class="p">[</span><span class="s2">&quot;num_prior_edges&quot;</span><span class="p">]</span>

        <span class="c1"># Retrieve the selected nodes and edges based on the given vertices and edges</span>
        <span class="n">subgraph_nodes</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">vertices</span> <span class="o">&lt;</span> <span class="n">num_nodes</span><span class="p">]</span>
        <span class="n">subgraph_edges</span> <span class="o">=</span> <span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">][</span><span class="n">e</span><span class="o">.</span><span class="n">item</span><span class="p">()]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edges</span> <span class="k">if</span> <span class="n">e</span> <span class="o">&lt;</span> <span class="n">num_prior_edges</span><span class="p">]</span>
        <span class="n">virtual_vertices</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">vertices</span> <span class="o">&gt;=</span> <span class="n">num_nodes</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">virtual_vertices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">virtual_edges</span> <span class="o">=</span> <span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">][</span><span class="n">i</span><span class="o">.</span><span class="n">item</span><span class="p">()]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">virtual_vertices</span><span class="p">]</span>
            <span class="n">subgraph_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">subgraph_edges</span> <span class="o">+</span> <span class="n">virtual_edges</span><span class="p">)</span>
        <span class="n">edge_index</span> <span class="o">=</span> <span class="n">edges_dict</span><span class="p">[</span><span class="s2">&quot;edge_index&quot;</span><span class="p">][:,</span> <span class="n">subgraph_edges</span><span class="p">]</span>
        <span class="n">subgraph_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">subgraph_nodes</span><span class="p">,</span> <span class="n">edge_index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge_index</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;nodes&quot;</span><span class="p">:</span> <span class="n">subgraph_nodes</span><span class="p">,</span> <span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="n">subgraph_edges</span><span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">extract_subgraph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text_emb</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">query_emb</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">modality</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">cfg</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform the Prize-Collecting Steiner Tree (PCST) algorithm to extract the subgraph.</span>

<span class="sd">        Args:</span>
<span class="sd">            text_emb: The textual description embedding.</span>
<span class="sd">            query_emb: The query embedding. This can be an embedding of</span>
<span class="sd">                a prompt, sequence, or any other feature to be used for the subgraph extraction.</span>
<span class="sd">            modality: The modality to use for the subgraph extraction</span>
<span class="sd">                (e.g., &quot;text&quot;, &quot;sequence&quot;, &quot;smiles&quot;).</span>
<span class="sd">            cfg: The configuration dictionary containing the Milvus setup.</span>

<span class="sd">        Returns:</span>
<span class="sd">            The selected nodes and edges of the subgraph.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Load the collections for nodes</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Preparing collections&quot;</span><span class="p">)</span>
        <span class="n">colls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_collections</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">modality</span><span class="p">)</span>

        <span class="c1"># Load edge index directly from Milvus (replaces pickle cache)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Loading edge index from Milvus&quot;</span><span class="p">)</span>
        <span class="n">edge_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_edge_index</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>

        <span class="c1"># Assert the topk and topk_e values for subgraph retrieval</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">topk</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;topk must be greater than or equal to 0&quot;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">topk_e</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;topk_e must be greater than or equal to 0&quot;</span>

        <span class="c1"># Retrieve the top-k nodes and edges based on the query embedding</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;compute_prizes&quot;</span><span class="p">)</span>
        <span class="n">prizes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_prizes</span><span class="p">(</span><span class="n">text_emb</span><span class="p">,</span> <span class="n">query_emb</span><span class="p">,</span> <span class="n">colls</span><span class="p">)</span>

        <span class="c1"># Compute costs in constructing the subgraph</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;compute_subgraph_costs&quot;</span><span class="p">)</span>
        <span class="n">edges_dict</span><span class="p">,</span> <span class="n">prizes</span><span class="p">,</span> <span class="n">costs</span><span class="p">,</span> <span class="n">mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_subgraph_costs</span><span class="p">(</span>
            <span class="n">edge_index</span><span class="p">,</span> <span class="n">colls</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">num_entities</span><span class="p">,</span> <span class="n">prizes</span>
        <span class="p">)</span>

        <span class="c1"># Retrieve the subgraph using the PCST algorithm</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Running PCST algorithm&quot;</span><span class="p">)</span>
        <span class="n">result_vertices</span><span class="p">,</span> <span class="n">result_edges</span> <span class="o">=</span> <span class="n">pcst_fast</span><span class="o">.</span><span class="n">pcst_fast</span><span class="p">(</span>
            <span class="n">edges_dict</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="n">prizes</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="n">costs</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num_clusters</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pruning</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">verbosity_level</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Get subgraph nodes and edges based on the result of the PCST algorithm</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Getting subgraph nodes and edges&quot;</span><span class="p">)</span>
        <span class="n">subgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subgraph_nodes_edges</span><span class="p">(</span>
            <span class="n">colls</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">num_entities</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">result_vertices</span><span class="p">),</span>
            <span class="p">{</span>
                <span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">result_edges</span><span class="p">),</span>
                <span class="s2">&quot;num_prior_edges&quot;</span><span class="p">:</span> <span class="n">edges_dict</span><span class="p">[</span><span class="s2">&quot;num_prior_edges&quot;</span><span class="p">],</span>
                <span class="s2">&quot;edge_index&quot;</span><span class="p">:</span> <span class="n">edge_index</span><span class="p">,</span>
            <span class="p">},</span>
            <span class="n">mapping</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">subgraph</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">subgraph</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning._compute_edge_prizes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_compute_edge_prizes</span><span class="p">(</span><span class="n">text_emb</span><span class="p">,</span> <span class="n">colls</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Compute the edge prizes based on the similarity between the query and edges.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text_emb</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The textual description embedding.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>colls</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The collections of nodes, node-type specific nodes, and edges in Milvus.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The prizes of the edges.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aiagents4pharma/talk2knowledgegraphs/utils/extractions/milvus_multimodal_pcst.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_compute_edge_prizes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text_emb</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">colls</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the edge prizes based on the similarity between the query and edges.</span>

<span class="sd">    Args:</span>
<span class="sd">        text_emb: The textual description embedding.</span>
<span class="sd">        colls: The collections of nodes, node-type specific nodes, and edges in Milvus.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The prizes of the edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialize several variables</span>
    <span class="n">topk_e</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topk_e</span><span class="p">,</span> <span class="n">colls</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">num_entities</span><span class="p">)</span>
    <span class="n">e_prizes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">colls</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">num_entities</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="c1"># Get the actual metric type to use</span>
    <span class="n">actual_metric_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric_type</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">metric_type</span>

    <span class="c1"># Search the collection with the query embedding</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">colls</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
        <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">text_emb</span><span class="p">],</span>
        <span class="n">anns_field</span><span class="o">=</span><span class="s2">&quot;feat_emb&quot;</span><span class="p">,</span>
        <span class="n">param</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;metric_type&quot;</span><span class="p">:</span> <span class="n">actual_metric_type</span><span class="p">},</span>
        <span class="n">limit</span><span class="o">=</span><span class="n">topk_e</span><span class="p">,</span>  <span class="c1"># Only retrieve the top-k edges</span>
        <span class="n">output_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;head_id&quot;</span><span class="p">,</span> <span class="s2">&quot;tail_id&quot;</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="c1"># Update the prizes based on the search results</span>
    <span class="n">e_prizes</span><span class="p">[[</span><span class="n">r</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span><span class="o">.</span><span class="n">score</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

    <span class="c1"># Further process the edge_prizes</span>
    <span class="n">unique_prizes</span><span class="p">,</span> <span class="n">inverse_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">e_prizes</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">topk_e_values</span> <span class="o">=</span> <span class="n">unique_prizes</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="n">unique_prizes</span><span class="p">)[:</span><span class="n">topk_e</span><span class="p">]]</span>
    <span class="n">last_topk_e_value</span> <span class="o">=</span> <span class="n">topk_e</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">topk_e</span><span class="p">):</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">inverse_indices</span> <span class="o">==</span> <span class="p">(</span><span class="n">unique_prizes</span> <span class="o">==</span> <span class="n">topk_e_values</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">min</span><span class="p">((</span><span class="n">topk_e</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="n">indices</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">last_topk_e_value</span><span class="p">)</span>
        <span class="n">e_prizes</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">last_topk_e_value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_const</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">e_prizes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning._compute_edge_prizes_async" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_compute_edge_prizes_async</span><span class="p">(</span><span class="n">text_emb</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">,</span> <span class="n">connection_manager</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Compute the edge prizes asynchronously using connection manager.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text_emb</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The textual description embedding</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the edges collection</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>connection_manager</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The MilvusConnectionManager instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The prizes of the edges</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aiagents4pharma/talk2knowledgegraphs/utils/extractions/milvus_multimodal_pcst.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_compute_edge_prizes_async</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">text_emb</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">connection_manager</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the edge prizes asynchronously using connection manager.</span>

<span class="sd">    Args:</span>
<span class="sd">        text_emb: The textual description embedding</span>
<span class="sd">        collection_name: Name of the edges collection</span>
<span class="sd">        connection_manager: The MilvusConnectionManager instance</span>

<span class="sd">    Returns:</span>
<span class="sd">        The prizes of the edges</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get collection stats for initialization</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="k">await</span> <span class="n">connection_manager</span><span class="o">.</span><span class="n">async_get_collection_stats</span><span class="p">(</span><span class="n">collection_name</span><span class="p">)</span>
    <span class="n">num_entities</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;num_entities&quot;</span><span class="p">]</span>

    <span class="c1"># Initialize prizes array</span>
    <span class="n">topk_e</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topk_e</span><span class="p">,</span> <span class="n">num_entities</span><span class="p">)</span>
    <span class="n">e_prizes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_entities</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="c1"># Get the actual metric type to use</span>
    <span class="n">actual_metric_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric_type</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">metric_type</span>

    <span class="c1"># Perform async search</span>
    <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">connection_manager</span><span class="o">.</span><span class="n">async_search</span><span class="p">(</span>
        <span class="n">collection_name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">text_emb</span><span class="p">],</span>
        <span class="n">anns_field</span><span class="o">=</span><span class="s2">&quot;feat_emb&quot;</span><span class="p">,</span>
        <span class="n">param</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;metric_type&quot;</span><span class="p">:</span> <span class="n">actual_metric_type</span><span class="p">},</span>
        <span class="n">limit</span><span class="o">=</span><span class="n">topk_e</span><span class="p">,</span>
        <span class="n">output_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;head_id&quot;</span><span class="p">,</span> <span class="s2">&quot;tail_id&quot;</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="c1"># Update the prizes based on the search results</span>
    <span class="k">if</span> <span class="n">results</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">result_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">hit</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">hit</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">result_scores</span> <span class="o">=</span> <span class="p">[</span><span class="n">hit</span><span class="p">[</span><span class="s2">&quot;distance&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">hit</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>  <span class="c1"># Use distance/score</span>
        <span class="n">e_prizes</span><span class="p">[</span><span class="n">result_ids</span><span class="p">]</span> <span class="o">=</span> <span class="n">result_scores</span>

    <span class="c1"># Process edge prizes using helper method</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_edge_prizes</span><span class="p">(</span><span class="n">e_prizes</span><span class="p">,</span> <span class="n">topk_e</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning._compute_node_prizes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_compute_node_prizes</span><span class="p">(</span><span class="n">query_emb</span><span class="p">,</span> <span class="n">colls</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Compute the node prizes based on the similarity between the query and nodes.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>query_emb</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The query embedding. This can be an embedding of
a prompt, sequence, or any other feature to be used for the subgraph extraction.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>colls</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The collections of nodes, node-type specific nodes, and edges in Milvus.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The prizes of the nodes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aiagents4pharma/talk2knowledgegraphs/utils/extractions/milvus_multimodal_pcst.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_compute_node_prizes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query_emb</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">colls</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the node prizes based on the similarity between the query and nodes.</span>

<span class="sd">    Args:</span>
<span class="sd">        query_emb: The query embedding. This can be an embedding of</span>
<span class="sd">            a prompt, sequence, or any other feature to be used for the subgraph extraction.</span>
<span class="sd">        colls: The collections of nodes, node-type specific nodes, and edges in Milvus.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The prizes of the nodes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialize several variables</span>
    <span class="n">topk</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topk</span><span class="p">,</span> <span class="n">colls</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">num_entities</span><span class="p">)</span>
    <span class="n">n_prizes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">colls</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">num_entities</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="c1"># Get the actual metric type to use</span>
    <span class="n">actual_metric_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric_type</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">metric_type</span>

    <span class="c1"># Calculate similarity for text features and update the score</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_description</span><span class="p">:</span>
        <span class="c1"># Search the collection with the text embedding</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">colls</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">query_emb</span><span class="p">],</span>
            <span class="n">anns_field</span><span class="o">=</span><span class="s2">&quot;desc_emb&quot;</span><span class="p">,</span>
            <span class="n">param</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;metric_type&quot;</span><span class="p">:</span> <span class="n">actual_metric_type</span><span class="p">},</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">topk</span><span class="p">,</span>
            <span class="n">output_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;node_id&quot;</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Search the collection with the query embedding</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">colls</span><span class="p">[</span><span class="s2">&quot;nodes_type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">search</span><span class="p">(</span>
            <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">query_emb</span><span class="p">],</span>
            <span class="n">anns_field</span><span class="o">=</span><span class="s2">&quot;feat_emb&quot;</span><span class="p">,</span>
            <span class="n">param</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;metric_type&quot;</span><span class="p">:</span> <span class="n">actual_metric_type</span><span class="p">},</span>
            <span class="n">limit</span><span class="o">=</span><span class="n">topk</span><span class="p">,</span>
            <span class="n">output_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;node_id&quot;</span><span class="p">],</span>
        <span class="p">)</span>

    <span class="c1"># Update the prizes based on the search results</span>
    <span class="n">n_prizes</span><span class="p">[[</span><span class="n">r</span><span class="o">.</span><span class="n">id</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">res</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">topk</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">float32</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">n_prizes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning._compute_node_prizes_async" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_compute_node_prizes_async</span><span class="p">(</span><span class="n">query_emb</span><span class="p">,</span> <span class="n">collection_name</span><span class="p">,</span> <span class="n">connection_manager</span><span class="p">,</span> <span class="n">use_description</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Compute the node prizes asynchronously using connection manager.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>query_emb</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The query embedding</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>collection_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the collection to search</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>connection_manager</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The MilvusConnectionManager instance</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_description</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use description embeddings</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The prizes of the nodes</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aiagents4pharma/talk2knowledgegraphs/utils/extractions/milvus_multimodal_pcst.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">_compute_node_prizes_async</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">query_emb</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span>
    <span class="n">collection_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">connection_manager</span><span class="p">,</span>
    <span class="n">use_description</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the node prizes asynchronously using connection manager.</span>

<span class="sd">    Args:</span>
<span class="sd">        query_emb: The query embedding</span>
<span class="sd">        collection_name: Name of the collection to search</span>
<span class="sd">        connection_manager: The MilvusConnectionManager instance</span>
<span class="sd">        use_description: Whether to use description embeddings</span>

<span class="sd">    Returns:</span>
<span class="sd">        The prizes of the nodes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get collection stats for initialization</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="k">await</span> <span class="n">connection_manager</span><span class="o">.</span><span class="n">async_get_collection_stats</span><span class="p">(</span><span class="n">collection_name</span><span class="p">)</span>
    <span class="n">num_entities</span> <span class="o">=</span> <span class="n">stats</span><span class="p">[</span><span class="s2">&quot;num_entities&quot;</span><span class="p">]</span>

    <span class="c1"># Initialize prizes array</span>
    <span class="n">topk</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">topk</span><span class="p">,</span> <span class="n">num_entities</span><span class="p">)</span>
    <span class="n">n_prizes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_entities</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="c1"># Get the actual metric type to use</span>
    <span class="n">actual_metric_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric_type</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">metric_type</span>

    <span class="c1"># Determine search field based on use_description</span>
    <span class="n">anns_field</span> <span class="o">=</span> <span class="s2">&quot;desc_emb&quot;</span> <span class="k">if</span> <span class="n">use_description</span> <span class="k">else</span> <span class="s2">&quot;feat_emb&quot;</span>

    <span class="c1"># Perform async search</span>
    <span class="n">results</span> <span class="o">=</span> <span class="k">await</span> <span class="n">connection_manager</span><span class="o">.</span><span class="n">async_search</span><span class="p">(</span>
        <span class="n">collection_name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">,</span>
        <span class="n">data</span><span class="o">=</span><span class="p">[</span><span class="n">query_emb</span><span class="p">],</span>
        <span class="n">anns_field</span><span class="o">=</span><span class="n">anns_field</span><span class="p">,</span>
        <span class="n">param</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;metric_type&quot;</span><span class="p">:</span> <span class="n">actual_metric_type</span><span class="p">},</span>
        <span class="n">limit</span><span class="o">=</span><span class="n">topk</span><span class="p">,</span>
        <span class="n">output_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;node_id&quot;</span><span class="p">],</span>
    <span class="p">)</span>

    <span class="c1"># Update the prizes based on the search results</span>
    <span class="k">if</span> <span class="n">results</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">results</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">result_ids</span> <span class="o">=</span> <span class="p">[</span><span class="n">hit</span><span class="p">[</span><span class="s2">&quot;id&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">hit</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
        <span class="n">n_prizes</span><span class="p">[</span><span class="n">result_ids</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">topk</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">n_prizes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning._process_edge_prizes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_process_edge_prizes</span><span class="p">(</span><span class="n">e_prizes</span><span class="p">,</span> <span class="n">topk_e</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Helper method to process edge prizes and reduce complexity.</p>


            <details class="quote">
              <summary>Source code in <code>aiagents4pharma/talk2knowledgegraphs/utils/extractions/milvus_multimodal_pcst.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_process_edge_prizes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">e_prizes</span><span class="p">,</span> <span class="n">topk_e</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper method to process edge prizes and reduce complexity.&quot;&quot;&quot;</span>
    <span class="n">unique_prizes</span><span class="p">,</span> <span class="n">inverse_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">e_prizes</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">sorted_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="o">-</span><span class="n">unique_prizes</span><span class="p">)[:</span><span class="n">topk_e</span><span class="p">]</span>
    <span class="n">topk_e_values</span> <span class="o">=</span> <span class="n">unique_prizes</span><span class="p">[</span><span class="n">sorted_indices</span><span class="p">]</span>
    <span class="n">last_topk_e_value</span> <span class="o">=</span> <span class="n">topk_e</span>

    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">topk_e</span><span class="p">):</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">inverse_indices</span> <span class="o">==</span> <span class="p">(</span><span class="n">unique_prizes</span> <span class="o">==</span> <span class="n">topk_e_values</span><span class="p">[</span><span class="n">k</span><span class="p">])</span><span class="o">.</span><span class="n">nonzero</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">min</span><span class="p">((</span><span class="n">topk_e</span> <span class="o">-</span> <span class="n">k</span><span class="p">)</span> <span class="o">/</span> <span class="n">indices</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">item</span><span class="p">(),</span> <span class="n">last_topk_e_value</span><span class="p">)</span>
        <span class="n">e_prizes</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">last_topk_e_value</span> <span class="o">=</span> <span class="n">value</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_const</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">e_prizes</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning.compute_prizes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_prizes</span><span class="p">(</span><span class="n">text_emb</span><span class="p">,</span> <span class="n">query_emb</span><span class="p">,</span> <span class="n">colls</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Compute the node prizes based on the cosine similarity between the query and nodes,
as well as the edge prizes based on the cosine similarity between the query and edges.
Note that the node and edge embeddings shall use the same embedding model and dimensions
with the query.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text_emb</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The textual description embedding.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>query_emb</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The query embedding. This can be an embedding of
a prompt, sequence, or any other feature to be used for the subgraph extraction.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>colls</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The collections of nodes, node-type specific nodes, and edges in Milvus.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The prizes of the nodes and edges.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aiagents4pharma/talk2knowledgegraphs/utils/extractions/milvus_multimodal_pcst.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_prizes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text_emb</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">query_emb</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">colls</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the node prizes based on the cosine similarity between the query and nodes,</span>
<span class="sd">    as well as the edge prizes based on the cosine similarity between the query and edges.</span>
<span class="sd">    Note that the node and edge embeddings shall use the same embedding model and dimensions</span>
<span class="sd">    with the query.</span>

<span class="sd">    Args:</span>
<span class="sd">        text_emb: The textual description embedding.</span>
<span class="sd">        query_emb: The query embedding. This can be an embedding of</span>
<span class="sd">            a prompt, sequence, or any other feature to be used for the subgraph extraction.</span>
<span class="sd">        colls: The collections of nodes, node-type specific nodes, and edges in Milvus.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The prizes of the nodes and edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Compute prizes for nodes</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;_compute_node_prizes&quot;</span><span class="p">)</span>
    <span class="n">n_prizes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_node_prizes</span><span class="p">(</span><span class="n">query_emb</span><span class="p">,</span> <span class="n">colls</span><span class="p">)</span>

    <span class="c1"># Compute prizes for edges</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;_compute_edge_prizes&quot;</span><span class="p">)</span>
    <span class="n">e_prizes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_edge_prizes</span><span class="p">(</span><span class="n">text_emb</span><span class="p">,</span> <span class="n">colls</span><span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;nodes&quot;</span><span class="p">:</span> <span class="n">n_prizes</span><span class="p">,</span> <span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="n">e_prizes</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning.compute_prizes_async" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_prizes_async</span><span class="p">(</span><span class="n">text_emb</span><span class="p">,</span> <span class="n">query_emb</span><span class="p">,</span> <span class="n">cfg</span><span class="p">,</span> <span class="n">modality</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Compute node and edge prizes asynchronously in parallel using sync fallback.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text_emb</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The textual description embedding</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>query_emb</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The query embedding</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cfg</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The configuration dictionary containing the Milvus setup</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>modality</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The modality to use for the subgraph extraction</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The prizes of the nodes and edges</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aiagents4pharma/talk2knowledgegraphs/utils/extractions/milvus_multimodal_pcst.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">compute_prizes_async</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">text_emb</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">query_emb</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">cfg</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">modality</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute node and edge prizes asynchronously in parallel using sync fallback.</span>

<span class="sd">    Args:</span>
<span class="sd">        text_emb: The textual description embedding</span>
<span class="sd">        query_emb: The query embedding</span>
<span class="sd">        cfg: The configuration dictionary containing the Milvus setup</span>
<span class="sd">        modality: The modality to use for the subgraph extraction</span>

<span class="sd">    Returns:</span>
<span class="sd">        The prizes of the nodes and edges</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Computing prizes in parallel (hybrid async/sync)&quot;</span><span class="p">)</span>

    <span class="c1"># Use existing sync method wrapped in asyncio.to_thread</span>
    <span class="n">colls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_collections</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">modality</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">to_thread</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">compute_prizes</span><span class="p">,</span> <span class="n">text_emb</span><span class="p">,</span> <span class="n">query_emb</span><span class="p">,</span> <span class="n">colls</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning.compute_subgraph_costs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_subgraph_costs</span><span class="p">(</span><span class="n">edge_index</span><span class="p">,</span> <span class="n">num_nodes</span><span class="p">,</span> <span class="n">prizes</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Compute the costs in constructing the subgraph proposed by G-Retriever paper.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>edge_index</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The edge index of the graph, consisting of source and destination nodes.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_nodes</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of nodes in the graph.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prizes</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The prizes of the nodes and the edges.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>edges</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The edges of the subgraph, consisting of edges and number of edges without
virtual edges.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>prizes</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The prizes of the subgraph.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>costs</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The costs of the subgraph.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aiagents4pharma/talk2knowledgegraphs/utils/extractions/milvus_multimodal_pcst.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_subgraph_costs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edge_index</span><span class="p">,</span> <span class="n">num_nodes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">prizes</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the costs in constructing the subgraph proposed by G-Retriever paper.</span>

<span class="sd">    Args:</span>
<span class="sd">        edge_index: The edge index of the graph, consisting of source and destination nodes.</span>
<span class="sd">        num_nodes: The number of nodes in the graph.</span>
<span class="sd">        prizes: The prizes of the nodes and the edges.</span>

<span class="sd">    Returns:</span>
<span class="sd">        edges: The edges of the subgraph, consisting of edges and number of edges without</span>
<span class="sd">            virtual edges.</span>
<span class="sd">        prizes: The prizes of the subgraph.</span>
<span class="sd">        costs: The costs of the subgraph.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialize several variables</span>
    <span class="n">real_</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">virt_</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Update edge cost threshold</span>
    <span class="n">updated_cost_e</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cost_e</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">prizes</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">item</span><span class="p">()</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">c_const</span> <span class="o">/</span> <span class="mi">2</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Masks for real and virtual edges</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Creating masks for real and virtual edges&quot;</span><span class="p">)</span>
    <span class="n">real_</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prizes</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">updated_cost_e</span>
    <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">~</span><span class="n">real_</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">]</span>

    <span class="c1"># Real edge indices</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Computing real edges&quot;</span><span class="p">)</span>
    <span class="n">real_</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">real_</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">real_</span><span class="p">[</span><span class="s2">&quot;src&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_index</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">real_</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">]]</span>
    <span class="n">real_</span><span class="p">[</span><span class="s2">&quot;dst&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_index</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">real_</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">]]</span>
    <span class="n">real_</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">real_</span><span class="p">[</span><span class="s2">&quot;src&quot;</span><span class="p">],</span> <span class="n">real_</span><span class="p">[</span><span class="s2">&quot;dst&quot;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">real_</span><span class="p">[</span><span class="s2">&quot;costs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">updated_cost_e</span> <span class="o">-</span> <span class="n">prizes</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">][</span><span class="n">real_</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">]]</span>

    <span class="c1"># Edge index mapping: local real edge idx -&gt; original global index</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Creating mapping for real edges&quot;</span><span class="p">)</span>
    <span class="n">mapping_edges</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">real_</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">])),</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="n">real_</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">]),</span> <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Virtual edge handling</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Computing virtual edges&quot;</span><span class="p">)</span>
    <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;mask&quot;</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;src&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_index</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">]]</span>
    <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;dst&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge_index</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">]]</span>
    <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;prizes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prizes</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">][</span><span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">]]</span> <span class="o">-</span> <span class="n">updated_cost_e</span>

    <span class="c1"># Generate virtual node IDs</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Generating virtual node IDs&quot;</span><span class="p">)</span>
    <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;num&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;node_ids&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">num_nodes</span> <span class="o">+</span> <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;num&quot;</span><span class="p">])</span>

    <span class="c1"># Virtual edges: (src → virtual), (virtual → dst)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Creating virtual edges&quot;</span><span class="p">)</span>
    <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;edges_1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;src&quot;</span><span class="p">],</span> <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;node_ids&quot;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;edges_2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">stack</span><span class="p">([</span><span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;node_ids&quot;</span><span class="p">],</span> <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;dst&quot;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;edges_1&quot;</span><span class="p">],</span> <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;edges_2&quot;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;costs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
        <span class="p">(</span><span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">real_</span><span class="p">[</span><span class="s2">&quot;costs&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span>
    <span class="p">)</span>

    <span class="c1"># Combine real and virtual edges/costs</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Combining real and virtual edges/costs&quot;</span><span class="p">)</span>
    <span class="n">all_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">real_</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">],</span> <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">all_costs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">real_</span><span class="p">[</span><span class="s2">&quot;costs&quot;</span><span class="p">],</span> <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;costs&quot;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Final prizes</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Getting final prizes&quot;</span><span class="p">)</span>
    <span class="n">final_prizes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">prizes</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">],</span> <span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;prizes&quot;</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Mapping virtual node ID -&gt; edge index in original graph</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Creating mapping for virtual nodes&quot;</span><span class="p">)</span>
    <span class="n">mapping_nodes</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
        <span class="nb">zip</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;node_ids&quot;</span><span class="p">]),</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">to_list</span><span class="p">(</span><span class="n">virt_</span><span class="p">[</span><span class="s2">&quot;indices&quot;</span><span class="p">]),</span>
            <span class="n">strict</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Build return values</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Building return values&quot;</span><span class="p">)</span>
    <span class="n">edges_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="n">all_edges</span><span class="p">,</span>
        <span class="s2">&quot;num_prior_edges&quot;</span><span class="p">:</span> <span class="n">real_</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
    <span class="p">}</span>
    <span class="n">mapping</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="n">mapping_edges</span><span class="p">,</span>
        <span class="s2">&quot;nodes&quot;</span><span class="p">:</span> <span class="n">mapping_nodes</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">edges_dict</span><span class="p">,</span> <span class="n">final_prizes</span><span class="p">,</span> <span class="n">all_costs</span><span class="p">,</span> <span class="n">mapping</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning.extract_subgraph" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_subgraph</span><span class="p">(</span><span class="n">text_emb</span><span class="p">,</span> <span class="n">query_emb</span><span class="p">,</span> <span class="n">modality</span><span class="p">,</span> <span class="n">cfg</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Perform the Prize-Collecting Steiner Tree (PCST) algorithm to extract the subgraph.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>text_emb</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The textual description embedding.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>query_emb</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The query embedding. This can be an embedding of
a prompt, sequence, or any other feature to be used for the subgraph extraction.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>modality</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The modality to use for the subgraph extraction
(e.g., "text", "sequence", "smiles").</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cfg</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The configuration dictionary containing the Milvus setup.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The selected nodes and edges of the subgraph.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aiagents4pharma/talk2knowledgegraphs/utils/extractions/milvus_multimodal_pcst.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_subgraph</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">text_emb</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">query_emb</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">modality</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">cfg</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform the Prize-Collecting Steiner Tree (PCST) algorithm to extract the subgraph.</span>

<span class="sd">    Args:</span>
<span class="sd">        text_emb: The textual description embedding.</span>
<span class="sd">        query_emb: The query embedding. This can be an embedding of</span>
<span class="sd">            a prompt, sequence, or any other feature to be used for the subgraph extraction.</span>
<span class="sd">        modality: The modality to use for the subgraph extraction</span>
<span class="sd">            (e.g., &quot;text&quot;, &quot;sequence&quot;, &quot;smiles&quot;).</span>
<span class="sd">        cfg: The configuration dictionary containing the Milvus setup.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The selected nodes and edges of the subgraph.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Load the collections for nodes</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Preparing collections&quot;</span><span class="p">)</span>
    <span class="n">colls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">prepare_collections</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">modality</span><span class="p">)</span>

    <span class="c1"># Load edge index directly from Milvus (replaces pickle cache)</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Loading edge index from Milvus&quot;</span><span class="p">)</span>
    <span class="n">edge_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_edge_index</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>

    <span class="c1"># Assert the topk and topk_e values for subgraph retrieval</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">topk</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;topk must be greater than or equal to 0&quot;</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">topk_e</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;topk_e must be greater than or equal to 0&quot;</span>

    <span class="c1"># Retrieve the top-k nodes and edges based on the query embedding</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;compute_prizes&quot;</span><span class="p">)</span>
    <span class="n">prizes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_prizes</span><span class="p">(</span><span class="n">text_emb</span><span class="p">,</span> <span class="n">query_emb</span><span class="p">,</span> <span class="n">colls</span><span class="p">)</span>

    <span class="c1"># Compute costs in constructing the subgraph</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;compute_subgraph_costs&quot;</span><span class="p">)</span>
    <span class="n">edges_dict</span><span class="p">,</span> <span class="n">prizes</span><span class="p">,</span> <span class="n">costs</span><span class="p">,</span> <span class="n">mapping</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_subgraph_costs</span><span class="p">(</span>
        <span class="n">edge_index</span><span class="p">,</span> <span class="n">colls</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">num_entities</span><span class="p">,</span> <span class="n">prizes</span>
    <span class="p">)</span>

    <span class="c1"># Retrieve the subgraph using the PCST algorithm</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Running PCST algorithm&quot;</span><span class="p">)</span>
    <span class="n">result_vertices</span><span class="p">,</span> <span class="n">result_edges</span> <span class="o">=</span> <span class="n">pcst_fast</span><span class="o">.</span><span class="n">pcst_fast</span><span class="p">(</span>
        <span class="n">edges_dict</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
        <span class="n">prizes</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
        <span class="n">costs</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">root</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_clusters</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pruning</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">verbosity_level</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># Get subgraph nodes and edges based on the result of the PCST algorithm</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Getting subgraph nodes and edges&quot;</span><span class="p">)</span>
    <span class="n">subgraph</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_subgraph_nodes_edges</span><span class="p">(</span>
        <span class="n">colls</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">num_entities</span><span class="p">,</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">result_vertices</span><span class="p">),</span>
        <span class="p">{</span>
            <span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">result_edges</span><span class="p">),</span>
            <span class="s2">&quot;num_prior_edges&quot;</span><span class="p">:</span> <span class="n">edges_dict</span><span class="p">[</span><span class="s2">&quot;num_prior_edges&quot;</span><span class="p">],</span>
            <span class="s2">&quot;edge_index&quot;</span><span class="p">:</span> <span class="n">edge_index</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="n">mapping</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">subgraph</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">subgraph</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning.get_subgraph_nodes_edges" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_subgraph_nodes_edges</span><span class="p">(</span><span class="n">num_nodes</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">edges_dict</span><span class="p">,</span> <span class="n">mapping</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get the selected nodes and edges of the subgraph based on the vertices and edges computed
by the PCST algorithm.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>num_nodes</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The number of nodes in the graph.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vertices</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The vertices selected by the PCST algorithm.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>edges_dict</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing the edges and the number of prior edges.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mapping</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing the mapping of nodes and edges.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The selected nodes and edges of the extracted subgraph.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aiagents4pharma/talk2knowledgegraphs/utils/extractions/milvus_multimodal_pcst.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_subgraph_nodes_edges</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">num_nodes</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">vertices</span><span class="p">,</span> <span class="n">edges_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">mapping</span><span class="p">:</span> <span class="nb">dict</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get the selected nodes and edges of the subgraph based on the vertices and edges computed</span>
<span class="sd">    by the PCST algorithm.</span>

<span class="sd">    Args:</span>
<span class="sd">        num_nodes: The number of nodes in the graph.</span>
<span class="sd">        vertices: The vertices selected by the PCST algorithm.</span>
<span class="sd">        edges_dict: A dictionary containing the edges and the number of prior edges.</span>
<span class="sd">        mapping: A dictionary containing the mapping of nodes and edges.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The selected nodes and edges of the extracted subgraph.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Get edges information</span>
    <span class="n">edges</span> <span class="o">=</span> <span class="n">edges_dict</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">]</span>
    <span class="n">num_prior_edges</span> <span class="o">=</span> <span class="n">edges_dict</span><span class="p">[</span><span class="s2">&quot;num_prior_edges&quot;</span><span class="p">]</span>

    <span class="c1"># Retrieve the selected nodes and edges based on the given vertices and edges</span>
    <span class="n">subgraph_nodes</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">vertices</span> <span class="o">&lt;</span> <span class="n">num_nodes</span><span class="p">]</span>
    <span class="n">subgraph_edges</span> <span class="o">=</span> <span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">][</span><span class="n">e</span><span class="o">.</span><span class="n">item</span><span class="p">()]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">edges</span> <span class="k">if</span> <span class="n">e</span> <span class="o">&lt;</span> <span class="n">num_prior_edges</span><span class="p">]</span>
    <span class="n">virtual_vertices</span> <span class="o">=</span> <span class="n">vertices</span><span class="p">[</span><span class="n">vertices</span> <span class="o">&gt;=</span> <span class="n">num_nodes</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">virtual_vertices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">virtual_edges</span> <span class="o">=</span> <span class="p">[</span><span class="n">mapping</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">][</span><span class="n">i</span><span class="o">.</span><span class="n">item</span><span class="p">()]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">virtual_vertices</span><span class="p">]</span>
        <span class="n">subgraph_edges</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">subgraph_edges</span> <span class="o">+</span> <span class="n">virtual_edges</span><span class="p">)</span>
    <span class="n">edge_index</span> <span class="o">=</span> <span class="n">edges_dict</span><span class="p">[</span><span class="s2">&quot;edge_index&quot;</span><span class="p">][:,</span> <span class="n">subgraph_edges</span><span class="p">]</span>
    <span class="n">subgraph_nodes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">subgraph_nodes</span><span class="p">,</span> <span class="n">edge_index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">edge_index</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;nodes&quot;</span><span class="p">:</span> <span class="n">subgraph_nodes</span><span class="p">,</span> <span class="s2">&quot;edges&quot;</span><span class="p">:</span> <span class="n">subgraph_edges</span><span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning.load_edge_index" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_edge_index</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Load edge index synchronously from Milvus collection.</p>
<p>This method queries the edges collection to get head_index and tail_index.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cfg</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The configuration dictionary containing the Milvus setup.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>numpy.ndarray: Edge index array with shape [2, num_edges]</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aiagents4pharma/talk2knowledgegraphs/utils/extractions/milvus_multimodal_pcst.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">load_edge_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load edge index synchronously from Milvus collection.</span>

<span class="sd">    This method queries the edges collection to get head_index and tail_index.</span>

<span class="sd">    Args:</span>
<span class="sd">        cfg: The configuration dictionary containing the Milvus setup.</span>

<span class="sd">    Returns:</span>
<span class="sd">        numpy.ndarray: Edge index array with shape [2, num_edges]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Loading edge index from Milvus collection (sync)&quot;</span><span class="p">)</span>

    <span class="n">collection_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cfg</span><span class="o">.</span><span class="n">milvus_db</span><span class="o">.</span><span class="n">database_name</span><span class="si">}</span><span class="s2">_edges&quot;</span>
    <span class="n">edges_collection</span> <span class="o">=</span> <span class="n">Collection</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">)</span>
    <span class="n">edges_collection</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

    <span class="c1"># Query all edges in batches</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">milvus_db</span><span class="p">,</span> <span class="s2">&quot;query_batch_size&quot;</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
    <span class="n">total_entities</span> <span class="o">=</span> <span class="n">edges_collection</span><span class="o">.</span><span class="n">num_entities</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Total edges to process: </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">total_entities</span><span class="p">)</span>

    <span class="n">head_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">tail_list</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">start</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">total_entities</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
        <span class="n">end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">total_entities</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Processing edge batch: </span><span class="si">%d</span><span class="s2"> to </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

        <span class="n">batch</span> <span class="o">=</span> <span class="n">edges_collection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
            <span class="n">expr</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;triplet_index &gt;= </span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2"> and triplet_index &lt; </span><span class="si">{</span><span class="n">end</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">output_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;head_index&quot;</span><span class="p">,</span> <span class="s2">&quot;tail_index&quot;</span><span class="p">],</span>
        <span class="p">)</span>

        <span class="n">head_list</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;head_index&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">])</span>
        <span class="n">tail_list</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;tail_index&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">])</span>

    <span class="c1"># Convert to numpy array format expected by PCST</span>
    <span class="n">edge_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">head_list</span><span class="p">,</span> <span class="n">tail_list</span><span class="p">])</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
        <span class="s2">&quot;Edge index loaded (sync): shape </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">edge_index</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">edge_index</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning.load_edge_index_async" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_edge_index_async</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">_connection_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-async"><code>async</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Load edge index using hybrid async/sync approach to avoid event loop issues.</p>
<p>This method queries the edges collection to get head_index and tail_index,
eliminating the need for pickle caching and reducing memory usage.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cfg</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The configuration dictionary containing the Milvus setup.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>_connection_manager</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Unused parameter for interface compatibility.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>numpy.ndarray: Edge index array with shape [2, num_edges]</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aiagents4pharma/talk2knowledgegraphs/utils/extractions/milvus_multimodal_pcst.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">async</span> <span class="k">def</span><span class="w"> </span><span class="nf">load_edge_index_async</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">_connection_manager</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load edge index using hybrid async/sync approach to avoid event loop issues.</span>

<span class="sd">    This method queries the edges collection to get head_index and tail_index,</span>
<span class="sd">    eliminating the need for pickle caching and reducing memory usage.</span>

<span class="sd">    Args:</span>
<span class="sd">        cfg: The configuration dictionary containing the Milvus setup.</span>
<span class="sd">        _connection_manager: Unused parameter for interface compatibility.</span>

<span class="sd">    Returns:</span>
<span class="sd">        numpy.ndarray: Edge index array with shape [2, num_edges]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Loading edge index from Milvus collection (hybrid)&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">load_edges_sync</span><span class="p">():</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Load edges synchronously to avoid event loop issues.&quot;&quot;&quot;</span>

        <span class="n">collection_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cfg</span><span class="o">.</span><span class="n">milvus_db</span><span class="o">.</span><span class="n">database_name</span><span class="si">}</span><span class="s2">_edges&quot;</span>
        <span class="n">edges_collection</span> <span class="o">=</span> <span class="n">Collection</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">collection_name</span><span class="p">)</span>
        <span class="n">edges_collection</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

        <span class="c1"># Query all edges in batches</span>
        <span class="n">batch_size</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">cfg</span><span class="o">.</span><span class="n">milvus_db</span><span class="p">,</span> <span class="s2">&quot;query_batch_size&quot;</span><span class="p">,</span> <span class="mi">10000</span><span class="p">)</span>
        <span class="n">total_entities</span> <span class="o">=</span> <span class="n">edges_collection</span><span class="o">.</span><span class="n">num_entities</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="s2">&quot;Total edges to process: </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">total_entities</span><span class="p">)</span>

        <span class="n">head_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">tail_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">start</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">total_entities</span><span class="p">,</span> <span class="n">batch_size</span><span class="p">):</span>
            <span class="n">end</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">start</span> <span class="o">+</span> <span class="n">batch_size</span><span class="p">,</span> <span class="n">total_entities</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Processing edge batch: </span><span class="si">%d</span><span class="s2"> to </span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>

            <span class="n">batch</span> <span class="o">=</span> <span class="n">edges_collection</span><span class="o">.</span><span class="n">query</span><span class="p">(</span>
                <span class="n">expr</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;triplet_index &gt;= </span><span class="si">{</span><span class="n">start</span><span class="si">}</span><span class="s2"> and triplet_index &lt; </span><span class="si">{</span><span class="n">end</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">output_fields</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;head_index&quot;</span><span class="p">,</span> <span class="s2">&quot;tail_index&quot;</span><span class="p">],</span>
            <span class="p">)</span>

            <span class="n">head_list</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;head_index&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">])</span>
            <span class="n">tail_list</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="n">r</span><span class="p">[</span><span class="s2">&quot;tail_index&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">batch</span><span class="p">])</span>

        <span class="c1"># Convert to numpy array format expected by PCST</span>
        <span class="n">edge_index</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loader</span><span class="o">.</span><span class="n">py</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">head_list</span><span class="p">,</span> <span class="n">tail_list</span><span class="p">])</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">log</span><span class="p">(</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span>
            <span class="s2">&quot;Edge index loaded (hybrid): shape </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">edge_index</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">edge_index</span>

    <span class="c1"># Run in thread to avoid event loop conflicts</span>
    <span class="k">return</span> <span class="k">await</span> <span class="n">asyncio</span><span class="o">.</span><span class="n">to_thread</span><span class="p">(</span><span class="n">load_edges_sync</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.MultimodalPCSTPruning.prepare_collections" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">prepare_collections</span><span class="p">(</span><span class="n">cfg</span><span class="p">,</span> <span class="n">modality</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Prepare the collections for nodes, node-type specific nodes, and edges in Milvus.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>cfg</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The configuration dictionary containing the Milvus setup.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>modality</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The modality to use for the subgraph extraction.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary containing the collections of nodes, node-type specific nodes, and edges.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>aiagents4pharma/talk2knowledgegraphs/utils/extractions/milvus_multimodal_pcst.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prepare_collections</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">cfg</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">modality</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prepare the collections for nodes, node-type specific nodes, and edges in Milvus.</span>

<span class="sd">    Args:</span>
<span class="sd">        cfg: The configuration dictionary containing the Milvus setup.</span>
<span class="sd">        modality: The modality to use for the subgraph extraction.</span>

<span class="sd">    Returns:</span>
<span class="sd">        A dictionary containing the collections of nodes, node-type specific nodes, and edges.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialize the collections dictionary</span>
    <span class="n">colls</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># Load the collection for nodes</span>
    <span class="n">colls</span><span class="p">[</span><span class="s2">&quot;nodes&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Collection</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cfg</span><span class="o">.</span><span class="n">milvus_db</span><span class="o">.</span><span class="n">database_name</span><span class="si">}</span><span class="s2">_nodes&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">modality</span> <span class="o">!=</span> <span class="s2">&quot;prompt&quot;</span><span class="p">:</span>
        <span class="c1"># Load the collection for the specific node type</span>
        <span class="n">colls</span><span class="p">[</span><span class="s2">&quot;nodes_type&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Collection</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cfg</span><span class="o">.</span><span class="n">milvus_db</span><span class="o">.</span><span class="n">database_name</span><span class="si">}</span><span class="s2">_nodes_</span><span class="si">{</span><span class="n">modality</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="c1"># Load the collection for edges</span>
    <span class="n">colls</span><span class="p">[</span><span class="s2">&quot;edges&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Collection</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">cfg</span><span class="o">.</span><span class="n">milvus_db</span><span class="o">.</span><span class="n">database_name</span><span class="si">}</span><span class="s2">_edges&quot;</span><span class="p">)</span>

    <span class="c1"># Load the collections</span>
    <span class="k">for</span> <span class="n">coll</span> <span class="ow">in</span> <span class="n">colls</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="n">coll</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">colls</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.SystemDetector" class="doc doc-heading">
            <code>SystemDetector</code>


</h2>


    <div class="doc doc-contents ">


        <p>Detect system capabilities and choose appropriate libraries.</p>








              <details class="quote">
                <summary>Source code in <code>aiagents4pharma/talk2knowledgegraphs/utils/extractions/milvus_multimodal_pcst.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">SystemDetector</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detect system capabilities and choose appropriate libraries.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">os_type</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>  <span class="c1"># &#39;windows&#39;, &#39;linux&#39;, &#39;darwin&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">architecture</span> <span class="o">=</span> <span class="n">platform</span><span class="o">.</span><span class="n">machine</span><span class="p">()</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>  <span class="c1"># &#39;x86_64&#39;, &#39;arm64&#39;, etc.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_nvidia_gpu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_detect_nvidia_gpu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">use_gpu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_nvidia_gpu</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">os_type</span> <span class="o">!=</span> <span class="s2">&quot;darwin&quot;</span>  <span class="c1"># No CUDA on macOS</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;System Detection Results:&quot;</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  OS: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">os_type</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  Architecture: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">architecture</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  NVIDIA GPU detected: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_nvidia_gpu</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;  Will use GPU acceleration: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_gpu</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_detect_nvidia_gpu</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Detect if NVIDIA GPU is available.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Try nvidia-smi command</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
                <span class="p">[</span><span class="s2">&quot;nvidia-smi&quot;</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span>
        <span class="k">except</span> <span class="p">(</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">TimeoutExpired</span><span class="p">,</span>
            <span class="ne">FileNotFoundError</span><span class="p">,</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">SubprocessError</span><span class="p">,</span>
        <span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_system_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get comprehensive system information.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span>
            <span class="s2">&quot;os_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">os_type</span><span class="p">,</span>
            <span class="s2">&quot;architecture&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">architecture</span><span class="p">,</span>
            <span class="s2">&quot;has_nvidia_gpu&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_nvidia_gpu</span><span class="p">,</span>
            <span class="s2">&quot;use_gpu&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_gpu</span><span class="p">,</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_gpu_compatible</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if the system is compatible with GPU acceleration.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_nvidia_gpu</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">os_type</span> <span class="o">!=</span> <span class="s2">&quot;darwin&quot;</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.SystemDetector._detect_nvidia_gpu" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">_detect_nvidia_gpu</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Detect if NVIDIA GPU is available.</p>


            <details class="quote">
              <summary>Source code in <code>aiagents4pharma/talk2knowledgegraphs/utils/extractions/milvus_multimodal_pcst.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">_detect_nvidia_gpu</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detect if NVIDIA GPU is available.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># Try nvidia-smi command</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;nvidia-smi&quot;</span><span class="p">],</span> <span class="n">capture_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">text</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span> <span class="o">==</span> <span class="mi">0</span>
    <span class="k">except</span> <span class="p">(</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">TimeoutExpired</span><span class="p">,</span>
        <span class="ne">FileNotFoundError</span><span class="p">,</span>
        <span class="n">subprocess</span><span class="o">.</span><span class="n">SubprocessError</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="k">return</span> <span class="kc">False</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.SystemDetector.get_system_info" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_system_info</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Get comprehensive system information.</p>


            <details class="quote">
              <summary>Source code in <code>aiagents4pharma/talk2knowledgegraphs/utils/extractions/milvus_multimodal_pcst.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_system_info</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get comprehensive system information.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">{</span>
        <span class="s2">&quot;os_type&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">os_type</span><span class="p">,</span>
        <span class="s2">&quot;architecture&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">architecture</span><span class="p">,</span>
        <span class="s2">&quot;has_nvidia_gpu&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_nvidia_gpu</span><span class="p">,</span>
        <span class="s2">&quot;use_gpu&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_gpu</span><span class="p">,</span>
    <span class="p">}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="aiagents4pharma.talk2knowledgegraphs.utils.extractions.milvus_multimodal_pcst.SystemDetector.is_gpu_compatible" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">is_gpu_compatible</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Check if the system is compatible with GPU acceleration.</p>


            <details class="quote">
              <summary>Source code in <code>aiagents4pharma/talk2knowledgegraphs/utils/extractions/milvus_multimodal_pcst.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">is_gpu_compatible</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check if the system is compatible with GPU acceleration.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_nvidia_gpu</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">os_type</span> <span class="o">!=</span> <span class="s2">&quot;darwin&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.top", "navigation.tabs", "navigation.instant", "navigation.expand", "navigation.sections", "navigation.indexes", "search.suggest", "search.highlight", "content.code.copy", "navigation.scrollable"], "search": "../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.92b07e13.min.js"></script>
      
    
  </body>
</html>